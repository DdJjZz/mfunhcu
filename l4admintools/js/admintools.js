function logout(){delCookie("Environmental.inspection.session"),window.location="http://"+window.location.host+install_path+"/login.html"}function goback(){delCookie("Environmental.inspection.session"),window.location="http://"+window.location.host+jump_url+"?session="+getQueryString("session")+"#"}function write_title(e,t){$("#page_title").empty(),$("#page_title").append("<h3>"+e+" <small>"+t+"</small></h3>")}function nav_check(){"true"==usr.admin?$("#Admin_menu").css("display","block"):$("#Admin_menu").css("display","none"),$("#Hello_label").text("您好："+usr.name);$(NaN);$("#Hello_label").append("<span class=' fa fa-angle-down'></span>")}function modal_middle(e){$BODY.hasClass("nav-md")||$MENU_TOGGLE.click(),setTimeout(function(){var t=$(e).find(".modal-dialog");parseInt(($(window).height()-t.height())/2)>0&&t.animate({"margin-top":parseInt(($(window).height()-t.height())/2)},300)},wait_time_short)}function PageInitialize(){get_user_information(),Software_Load_Management()}function hide_menu(){for(var e in usr.userauth.webauth)"false"==usr.userauth.webauth[e]&&$("#"+e).css("display","none")}function clear_window(){$("#SoftwareLoadview").css("display","none")}function get_user_information(){var e=getQueryString("session"),t={session:e},o={action:"UserInfo",type:"query",body:t,user:"null"},a=function(e){var t=e.status;"false"==t?show_alarm_module(!0,"获取用户失败，请联系管理员",null):(usr=e.ret,query_Software_Load_list())};JQ_get(request_head,o,a)}function show_expiredModule(){modal_middle($("#ExpiredAlarm")),$("#ExpiredAlarm").modal("show")}function Software_Load_Management(){clear_window(),write_title("软件包管理与下发",""),$("#SoftwareLoadview").css("display","block")}function query_Software_Load_list(){if(Software_Load_table_initialized===!0){var e={action:"GetSoftwareLoadTable",type:"query",user:usr.id},t=function(e){if("false"==e.status)return void show_expiredModule();var t=(new Date).Format("yyyy-MM-dd_hhmmss");$("#SoftwareLoadFlashTime").empty(),$("#SoftwareLoadFlashTime").append("最后刷新时间："+t);var o,a=e.ret.ColumnName,l=e.ret.TableData,n="<thead> <tr><th></th>";for(o=0;o<a.length;o++)n=n+"<th>"+a[o]+"</th>";for(n+="</tr></thead>",n+="<tbody>",o=0;o<l.length;o++){n=n+"<tr><td><button type='button' class='btn btn-default Soft_del_btn' SoftID='"+l[o][0]+"' ><em class='glyphicon glyphicon-trash ' aria-hidden='true' ></em></button></td>";for(var r=0;r<l[o].length;r++)n=n+"<td>"+l[o][r]+"</td>";n+="</tr>"}n+="</tbody>",$("#SoftwareLoadQueryTable").empty(),$("#SoftwareLoadQueryTable").append(n),$(".Soft_del_btn").on("click",function(){show_software_load_delete_module($(this).attr("SoftID"))}),Software_Load_table_initialized&&$("#SoftwareLoadQueryTable").DataTable().destroy();$("#SoftwareLoadQueryTable").DataTable({scrollY:!0,scrollCollapse:!0,scrollX:!0,searching:!1,autoWidth:!0,lengthChange:!1,dom:"Bfrtip",select:!0,buttons:{buttons:[{extend:"excel",text:"导出到excel",filename:"AlarmData"+t}]}});Software_Load_table_initialized=!0};JQ_get(admintools_head,e,t)}}function show_software_load_delete_module(e){$("#delSoftwareLoadCommit").attr("SoftID",e),$("#SoftwareLoadDelAlertModalLabel").text("确认删除 软件版本:["+e+"]"),modal_middle($("#SoftwareLoadDelAlarm")),$("#SoftwareLoadDelAlarm").modal("show")}function JQ_get(e,t,o){return"null"!=t.user&&"false"==usr.userauth[t.type]?void show_alarm_module(!0,"您没有进行此操作的权限",null):void jQuery.get(e,t,function(e){log(e);var t=JSON.parse(e);return"false"==t.status?void show_expiredModule():"false"==t.auth?void show_alarm_module(!0,"您没有进行此操作的权限："+t.msg,null):void o(t)})}function JQ_get_with_para(e,t,o,a){return"null"!=t.user&&"false"==usr.userauth[t.type]?void show_alarm_module(!0,"您没有进行此操作的权限",null):void jQuery.get(e,t,function(e){log(e);var t=JSON.parse(e);return"false"==t.status?void show_expiredModule():"false"==t.auth?void show_alarm_module(!0,"您没有进行此操作的权限："+t.msg,null):void o(t,a)})}function submit_new_software_load_module(){var e=$("#NewSoftwareLoadEquentry_Input").val(),t=$("#NewSoftwareValidFlag_Input").val(),o=$("#NewSoftwareUpgradeFlage_Input").val(),a=$("#NewSoftwareHWType_Input").val(),l=$("#NewSoftwareLoadHWID_Input").val(),n=$("#NewSoftwareSWRel_Input").val(),r=$("#NewSoftwareLoadSWVer_Input").val(),i=$("#NewSoftwareDBVer_Input").val(),d=$(".file-caption-name").attr("title");if(null===e||""===e)return $("#NewSoftwareLoadEquentry_Input").attr("placeholder","Equentry不能为空"),void $("#NewSoftwareLoadEquentry_Input").focus();if(null===t||""===t)return $("#NewSoftwareValidFlag_Input").attr("placeholder","validflag不能为空"),void $("#NewSoftwareValidFlag_Input").focus();if(null===o||""===o)return $("#NewSoftwareUpgradeFlage_Input").attr("placeholder","UpgradeFlage不能为空"),void $("#NewSoftwareUpgradeFlage_Input").focus();if(null===a||""===a)return $("#NewSoftwareLoadHWType_Input").attr("placeholder","HWType不能为空"),void $("#NewSoftwareLoadHWType_Input").focus();if(null===l||""===l)return $("#NewSoftwareLoadHWID_Input").attr("placeholder","HWID不能为空"),void $("#NewSoftwareLoadHWID_Input").focus();if(null===n||""===n)return $("#NewSoftwareSWRel_Input").attr("placeholder","SWRel不能为空"),void $("#NewSoftwareSWRel_Input").focus();if(null===r||""===r)return $("#NewSoftwareLoadSWVer_Input").attr("placeholder","SWVer不能为空"),void $("#NewSoftwareLoadSWVer_Input").focus();if(null===i||""===i)return $("#NewSoftwareDBVer_Input").attr("placeholder","DBVer不能为空"),void $("#NewSoftwareDBVer_Input").focus();if(null===d||""===d)return void $(".file-caption-name").focus();var u={equentry:e,validflag:t,upgradeflag:o,hwtype:a,hwid:l,swrel:n,swver:r,dbver:i,filename:d};new_software_load(u)}function new_software_load(e){var t={action:"SoftwareLoadNew",type:"mod",body:e,user:usr.id},o=function(e){var t=e.status;"true"==t?($("#newSoftwareLoadModal").modal("hide"),setTimeout(function(){show_alarm_module(!1,"创建成功！",query_Software_Load_list)},500)):setTimeout(function(){show_alarm_module(!0,"创建失败！"+e.msg,null)},500)};JQ_get(admintools_head,t,o)}function del_software_load(e){var t={softwareloadid:e},o={action:"SoftwareLoadDel",type:"mod",body:t,user:usr.id},a=function(e){var t=e.status;"true"==t?($("#SoftwareLoadDelAlarm").modal("hide"),setTimeout(function(){show_alarm_module(!1,"删除成功！",query_Software_Load_list)},500)):setTimeout(function(){show_alarm_module(!0,"删除失败！"+e.msg,null)},500)};JQ_get(admintools_head,o,a)}function show_alarm_module(e,t,o){e?($("#UserAlertModalLabel").text("警告"),$("#UserAlertModalContent").empty(),$("#UserAlertModalContent").append("<strong>警告！</strong>"+t)):($("#UserAlertModalLabel").text("通知"),$("#UserAlertModalContent").empty(),$("#UserAlertModalContent").append("<strong>通知：</strong>"+t)),modal_middle($("#UserAlarm")),$("#UserAlarm").modal("show"),null===o?(emptyfunction=function(){},$("#UserAlarm").on("hide.bs.modal",emptyfunction)):$("#UserAlarm").on("hide.bs.modal",function(){setTimeout(o,500)})}var basic_address=getRelativeURL()+"/";console.log(basic_address);var wait_time_long=3e3,wait_time_middle=1e3,wait_time_short=500,cycle_time=6e4,install_path="/mfunhcu/l4fhysui",request_head=install_path+"/request.php",admintools_head=basic_address+"/admintools.php",jump_url=install_path+"/jump.php",upload_url=basic_address+"/upload.php",usr;usr="";var Software_Load_table_initialized=!0,if_Software_Load_table_initialize=!1,CURRENT_URL="desktop",$BODY=$("body"),$MENU_TOGGLE=$("#menu_toggle"),$SIDEBAR_MENU=$("#sidebar-menu"),$SIDEBAR_FOOTER=$(".sidebar-footer"),$LEFT_COL=$(".left_col"),$RIGHT_COL=$(".right_col"),$NAV_MENU=$(".nav_menu"),$FOOTER=$("footer");$(document).ready(function(){var e=function(){$RIGHT_COL.css("min-height",$(window).height());var e=$BODY.outerHeight(),t=$FOOTER.outerHeight(),o=$LEFT_COL.eq(1).height()+$SIDEBAR_FOOTER.height(),a=e<o?o:e;a-=$NAV_MENU.outerHeight()+t,$RIGHT_COL.css("min-height",a)};$(window).smartresize(function(){e()}),e()}),function(e,t){var o=function(e,t,o){var a;return function(){function l(){o||e.apply(n,r),a=null}var n=this,r=arguments;a?clearTimeout(a):o&&e.apply(n,r),a=setTimeout(l,t||100)}};jQuery.fn[t]=function(e){return e?this.bind("resize",o(e)):this.trigger(t)}}(jQuery,"smartresize"),window.onload=function(){},$(document).ready(function(){$("[data-toggle='modal']").click(function(){var e=$(this).attr("data-target");t=setTimeout(function(){var t=$(e).find(".modal-dialog");t.animate({"margin-top":parseInt(($(window).height()-t.height())/2)},300)},wait_time_short)}),PageInitialize(),$("#menu_logout").on("click",function(){goback()}),$("#ExpiredConfirm").on("click",function(){logout()}),$("#NewSoftwareLoadModalShow").on("click",function(){$("#file-zh").fileinput({language:"zh",uploadUrl:upload_url+"?id="+usr.id,allowedFileExtensions:["swl"],showPreview:!1}),modal_middle($("#newSoftwareLoadModal")),$("#newSoftwareLoadModal").modal("show")}),$("#newSoftwareLoadCommit").on("click",function(){console.log("commit"),submit_new_software_load_module()}),$("#delSoftwareLoadCommit").on("click",function(){del_software_load($("#delSoftwareLoadCommit").attr("SoftID"))}),$(window).resize()});