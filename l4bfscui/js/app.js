function logout(){delCookie("Environmental.inspection.session"),window.location="http://"+window.location.host+basic_address+"Login.html"}function video_windows(e){window.open("http://"+window.location.host+basic_address+"/video/video.html?id="+e,"监控录像","height=284, width=340, top=0, left=400,toolbar=no, menubar=no, scrollbars=no, resizable=no, location=no, status=no")}function screen_windows(){window.open("http://"+window.location.host+screen_saver_address+"?id="+usr.id+"&StatCode="+monitor_selected.StatCode,"屏幕保护","height=auto, width=auto")}function write_title(e,t){$("#page_title").empty(),$("#page_title").append("<h3>"+e+" <small>"+t+"</small></h3>")}function active_menu(e){$SIDEBAR_MENU.find("li.active").addClass("active-sm").removeClass("active"),$SIDEBAR_MENU.find("li").each(function(){$(this).removeClass("current-page")}),$SIDEBAR_MENU.find('a[id="'+e+'"]').parent("li").addClass("current-page")}function nav_check(){"true"==usr.admin?$("#Admin_menu").css("display","block"):$("#Admin_menu").css("display","none"),$("#Hello_label").text("您好："+usr.name);$(NaN);$("#Hello_label").append("<span class=' fa fa-angle-down'></span>")}function show_alarm_module(e,t){e?($("#UserAlertModalLabel").text("警告"),$("#UserAlertModalContent").empty(),$("#UserAlertModalContent").append("<strong>警告！</strong>"+t)):($("#UserAlertModalLabel").text("通知"),$("#UserAlertModalContent").empty(),$("#UserAlertModalContent").append("<strong>通知：</strong>"+t)),modal_middle($("#UserAlarm")),$("#UserAlarm").modal("show")}function modal_middle(e){$BODY.hasClass("nav-md")||$MENU_TOGGLE.click(),setTimeout(function(){var t=$(e).find(".modal-dialog");parseInt(($(window).height()-t.height())/2)>0&&t.animate({"margin-top":parseInt(($(window).height()-t.height())/2)},300)},wait_time_short)}function on_collapse(e){touchcookie()}function PageInitialize(){get_user_information(),get_sensor_list(),get_camera_unit()}function get_user_information(){var e=getQueryString("session"),t={action:"UserInfo",session:e},o=function(e){var t=e.status;"false"==t?show_alarm_module(!0,"获取用户失败，请联系管理员"):(usr=e.ret,get_user_message(),get_user_image(),get_monitor_list(),nav_check())};JQ_get(request_head,t,o)}function show_expiredModule(){modal_middle($("#ExpiredAlarm")),$("#ExpiredAlarm").modal("show")}function calculate_row(){var e=($(window).height(),parseInt(($(window).height()-650)/100));e<=0?table_row=5:e>=5?table_row=10:table_row+=e}function show_table_tags(){$("#Warning_"+alarm_type_list[0].id+"_day").css("display","block")}function user_manager(){clear_window(),write_title("用户管理","根据您的权限对用户进行添加/删除/修改等操作"),$("#UserManageView").css("display","block"),user_initial||user_intialize(0)}function pg_manage(){clear_window(),write_title("项目组管理","根据您的权限对项目组进行添加/删除/修改等操作"),$("#PGManageView").css("display","block"),pg_initial||pg_intialize(0)}function key_manage(){clear_window(),write_title("钥匙管理","根据您的权限对项目组进行添加/删除/修改等操作"),$("#KeyManageView").css("display","block"),key_initial||key_intialize(0)}function proj_manage(){clear_window(),write_title("项目管理","根据您的权限对项目进行添加/删除/修改等操作"),$("#ProjManageView").css("display","block"),proj_intialize(0)}function para_manage(){clear_window(),write_title("参数管理","您可以在这里升级您的设备版本"),$("#ParaManageView").css("display","block"),parameter_initial||parameter_initialize()}function mp_manage(){clear_window(),write_title("站点管理","根据您的权限对站点进行配置"),$("#MPManageView").css("display","block"),point_initial||point_intialize(0)}function dev_manage(){clear_window(),write_title("设备管理","根据您的权限对设备进行配置"),$("#DevManageView").css("display","block"),device_initial||dev_intialize(0)}function mp_monitor(){clear_window(),write_title("地图监控","在地图上对站点进行监控"),$("#MPMonitorView").css("display","block"),map_initialized||initializeMap()}function mp_monitor_table(){clear_window(),write_title("站点聚合","实时刷新"),$("#MPMonitorTableView").css("display","block"),Monitor_table_initialized||initialize_warning_table()}function mp_monitor_card(){clear_window(),write_title("站点列块","点选设备卡片以获得详细信息"),$("#MPMonitorCardView").css("display","block")}function mp_static_monitor_table(){clear_window(),write_title("站点聚合","请手工刷新"),$("#MPMonitorStaticTableView").css("display","block"),query_static_warning()}function warning_check(){clear_window(),write_title("告警查看","可以导出报表"),$("#WarningCheckView").css("display","block"),alarm_map_initialized||initializeAlarmMap()}function warning_handle(){clear_window(),write_title("施工中",""),$("#Undefined").css("display","block")}function desktop(){clear_window(),write_title("欢迎","请选择您需要的功能"),$("#Desktop").css("display","block")}function Inst_Conf(){clear_window(),write_title("施工中",""),$("#Undefined").css("display","block")}function Inst_Read(){clear_window(),write_title("施工中",""),$("#Undefined").css("display","block")}function Inst_Design(){clear_window(),write_title("施工中",""),$("#Undefined").css("display","block")}function Inst_Control(){clear_window(),write_title("施工中",""),$("#Undefined").css("display","block")}function Inst_Snapshot(){clear_window(),write_title("施工中",""),$("#Undefined").css("display","block")}function Inst_Video(){clear_window(),write_title("施工中",""),$("#Undefined").css("display","block")}function Audit_Target(){clear_window(),write_title("施工中",""),$("#Undefined").css("display","block")}function Audit_Stability(){clear_window(),write_title("施工中",""),$("#Undefined").css("display","block")}function Audit_Availability(){clear_window(),write_title("施工中",""),$("#Undefined").css("display","block")}function Audit_Error(){clear_window(),write_title("施工中",""),$("#Undefined").css("display","block")}function Audit_Quality(){clear_window(),write_title("施工中",""),$("#Undefined").css("display","block")}function Geo_InfoQuery(){clear_window(),CURRENT_URL="Undefined",write_title("施工中",""),$("#Undefined").css("display","block")}function Geo_TrendAnalysis(){clear_window(),CURRENT_URL="Undefined",write_title("施工中",""),$("#Undefined").css("display","block")}function Geo_DisaterForecast(){clear_window(),CURRENT_URL="Undefined",write_title("施工中",""),$("#Undefined").css("display","block")}function Geo_EmergencyDirect(){clear_window(),write_title("施工中",""),$("#Undefined").css("display","block")}function Geo_DiffusionAnalysis(){clear_window(),write_title("施工中",""),$("#Undefined").css("display","block")}function Work_flowDesign(){clear_window(),write_title("施工中",""),$("#Undefined").css("display","block")}function Order_Management(){clear_window(),write_title("施工中",""),$("#Undefined").css("display","block")}function Unloading_Management(){clear_window(),write_title("施工中",""),$("#Undefined").css("display","block")}function Order_Audit(){clear_window(),write_title("施工中",""),$("#Undefined").css("display","block")}function AD_Conf(){clear_window(),write_title("施工中",""),$("#Undefined").css("display","block")}function WEB_Conf(){clear_window(),write_title("施工中",""),$("#Undefined").css("display","block")}function key_auth(){clear_window(),write_title("钥匙授权",""),$("#KeyAuthView").css("display","block"),key_auth_initialize()}function key_history(){clear_window(),write_title("开锁历史查询","请输入查询条件"),$("#KeyHistoryView").css("display","block"),key_history_initialize()}function clear_window(){$("#UserManageView").css("display","none"),$("#PGManageView").css("display","none"),$("#ProjManageView").css("display","none"),$("#ParaManageView").css("display","none"),$("#MPManageView").css("display","none"),$("#DevManageView").css("display","none"),$("#MPMonitorView").css("display","none"),$("#MPMonitorTableView").css("display","none"),$("#MPMonitorCardView").css("display","none"),$("#MPMonitorStaticTableView").css("display","none"),$("#WarningCheckView").css("display","none"),$("#WarningHandleView").css("display","none"),$("#Desktop").css("display","none"),$("#Undefined").css("display","none"),$("#KeyManageView").css("display","none"),$("#KeyHistoryView").css("display","none"),$("#KeyAuthView").css("display","none")}function get_project_pg_list(){var e={action:"ProjectPGList",user:usr.id},t=function(e){return"false"==e.status?void show_expiredModule():void(project_pg_list=e.ret)};JQ_get(request_head,e,t)}function get_user_table(e,t){var o={action:"UserTable",startseq:e,length:t},a=function(e){return"false"==e.status?void show_expiredModule():(user_table=e.ret,user_start=parseInt(e.start),user_total=parseInt(e.total),void draw_user_table_head())};JQ_get(request_head,o,a)}function del_user(e){var t={action:"UserDel",id:e},o=function(e){var t=e.status;"true"==t?(show_alarm_module(!1,"删除成功！"),clear_user_detail_panel(),user_intialize(0)):show_alarm_module(!0,"删除失败！"+e.msg)};JQ_get(request_head,t,o),$("#UserDelAlarm").modal("hide")}function new_user(e,t){var o={action:"UserNew",name:e.name,nickname:e.nickname,password:e.password,mobile:e.mobile,mail:e.mail,type:e.type,memo:e.memo,auth:t},a=function(e){var t=e.status;"true"==t?(show_alarm_module(!1,"创建成功！"),$("#newUserModal").modal("hide"),clear_user_detail_panel(),user_intialize(0)):show_alarm_module(!0,"创建失败！"+e.msg)};JQ_get(request_head,o,a)}function modify_user(e,t){var o={action:"UserMod",id:e.id,name:e.name,nickname:e.nickname,password:e.password,mobile:e.mobile,mail:e.mail,type:e.type,memo:e.memo,auth:t},a=function(e){var t=e.status;"true"==t?(show_alarm_module(!1,"修改成功！"),$("#newUserModal").modal("hide"),clear_user_detail_panel(),user_intialize(0)):show_alarm_module(!0,"修改失败！"+e.msg)};JQ_get(request_head,o,a)}function get_user_proj(e){var t={action:"UserProj",userid:e},o=function(e){return"false"==e.status?void show_expiredModule():(user_selected_auth=e.ret,void draw_user_detail_proj_table())};JQ_get(request_head,t,o)}function get_user_key(e){var t={action:"UserKey",userid:e},o=function(e){return"false"==e.status?void show_expiredModule():(user_selected_key=e.ret,void draw_user_detail_key_table())};JQ_get(request_head,t,o)}function user_intialize(e){user_initial=!0,user_table=null,get_user_table(e,5*table_row),get_project_pg_list()}function draw_user_table_head(){if(null!==user_table){var e=Math.ceil(user_table.length/table_row);$("#User_Page_control").empty();var t,o="<li><a href='#' id='user_page_prev'>Prev</a></li>",a=Math.ceil(user_start/table_row);for(t=0;t<e;t++)o=o+"<li><a href='#' id='user_page_"+t+"'>"+(t+a+1)+"</a></li>";for(o+="<li><a href='#' id='user_page_next'>Next</a></li>",$("#User_Page_control").append(o),table_head="<thead><tr><th>序号</th><th>用户名</th><th>昵称</th><th>电话</th><th>属性</th><th>更新日期</th>",table_head+="</tr></thread>",click_draw_user_table=function(){draw_user_table($(this))},t=0;t<e;t++)$("#user_page_"+t).on("click",click_draw_user_table);user_start<=0?$("#user_page_prev").css("display","none"):($("#user_page_prev").css("display","block"),$("#user_page_prev").on("click",function(){var e=user_start-5*table_row;e<0&&(e=0),user_intialize(e)})),user_start+5*table_row>=user_total?$("#user_page_next").css("display","none"):($("#user_page_next").css("display","block"),$("#user_page_next").on("click",function(){user_intialize(user_start+5*table_row)})),draw_user_table($("#user_page_0"))}}function draw_user_table(e){if($("#Table_user").empty(),null!==user_table){var t=(parseInt(e.html())-1)*table_row-user_start,o=table_head;o+="<tbody>";var a;for(a=0;a<table_row;a++)t+a<user_table.length?(o=0!==a%2?o+"<tr class='success li_menu' id='table_cell"+a+"' userid='"+user_table[t+a].id+"'>":o+"<tr class='li_menu' id='table_cell"+a+"' userid='"+user_table[t+a].id+"'>",o=o+"<td>"+user_table[t+a].id+"</td><td>"+user_table[t+a].name+"</td><td>"+user_table[t+a].nickname+"</td><td>"+user_table[t+a].mobile+"</td>",o+="true"==user_table[t+a].type?"<td>管理员</td>":"<td>用户</td>",o=o+"<td>"+user_table[t+a].date+"</td>",o+="</tr>"):(o=0!==a%2?o+"<tr class='success' id='table_cell"+a+"' userid='null'>":o+"<tr  id='table_cell"+a+"' userid='null'>",o+="<td>--</td><td>--</td><td>--</td><td>--</td><td>--</td><td>--</td>",o+="</tr>");for(o+="</tbody>",$("#Table_user").append(o),table_cell_click=function(){if("null"!=$(this).attr("userid")){for(var e=0;e<user_table.length;e++)if($(this).attr("userid")==user_table[e].id){user_selected=user_table[e];break}Initialize_user_detail(),touchcookie()}},a=0;a<table_row;a++)$("#table_cell"+a).on("click",table_cell_click)}}function Initialize_user_detail(){draw_user_detail_panel(),get_user_key(user_selected.id),get_user_proj(user_selected.id)}function clear_user_detail_panel(){user_selected=null;var e="<p></p><p></p><div class='col-md-6 col-sm-6 col-xs-12 column'><dl ><dt >用户名：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd><dt >用户类型：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd><dt >联系方式：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd></dl></div><div class='col-md-6 col-sm-6 col-xs-12 column'><dl ><dt>用户昵称：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd><dt>修改日期：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd><dt>邮箱：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd></dl></div><div class='col-md-12 col-sm-12 col-xs-12 column'><dl ><dt>备注：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd></dl></div>";$("#Label_user_detail").empty(),$("#Label_user_detail").append(e),$("#Table_user_authed").empty(),$("#Table_user_key").empty()}function draw_user_detail_panel(){if($("#Label_user_detail").empty(),null!==user_selected_auth){var e="用户";!0===user_selected.type&&(e="管理员");var t="<p></p><p></p><div class='col-md-6 col-sm-6 col-xs-12 column'><dl ><dt >用户名：</dt><dd>"+user_selected.name+"</dd><dt >用户类型：</dt><dd>"+e+"</dd><dt >联系方式：</dt><dd>"+user_selected.mobile+"</dd></dl></div><div class='col-md-6 col-sm-6 col-xs-12 column'><dl ><dt>用户昵称：</dt><dd>"+user_selected.nickname+"</dd><dt>修改日期：</dt><dd>"+user_selected.date+"</dd><dt>邮箱：</dt><dd>"+user_selected.mail+"</dd></dl></div><div class='col-md-12 col-sm-12 col-xs-12 column'><dl ><dt>备注：</dt><dd>"+user_selected.memo+"</dd></dl></div>";$("#Label_user_detail").append(t)}}function draw_user_detail_proj_table(){$("#Table_user_authed").empty(),txt="<thead> <tr> <th>已关联项目 </th> </tr> </thead> <tbody >";for(var e=0;e<user_selected_auth.length;e++)txt=txt+"<tr> <td>"+user_selected_auth[e].name+"</td> </tr>";txt+="</tbody>",$("#Table_user_authed").append(txt)}function draw_user_detail_key_table(){$("#Table_user_key").empty(),txt="<thead> <tr> <th>钥匙名称 </th> <th>归属项目 </th></tr> </thead> <tbody >";for(var e=0;e<user_selected_key.length;e++)txt=txt+"<tr id='"+user_selected_key[e].id+"' class='keyrow'> <td>"+user_selected_key[e].name+"</td> <td>"+user_selected_key[e].domain+"</td></tr>";txt+="</tbody>",$("#Table_user_key").append(txt),$(".keyrow").on("click",function(){var e=$(this).attr("id");void 0!==e&&""!==e&&get_key_auth_list(e)})}function show_new_user_module(){$("#newModalLabel").text("创建新用户"),user_module_status=!0,$("#NewUsername_Input").val(""),$("#NewUserNick_Input").val(""),$("#NewPassword_Input").val(""),$("#NewRePassword_Input").val(""),$("#NewUserMobile_Input").val(""),$("#NewUserMail_Input").val(""),$("#NewUserMemo_Input").val(""),$("#NewUserType_choice").val("false"),$("#NewUsername_Input").attr("placeholder","用户名"),$("#NewPassword_Input").attr("placeholder","密码"),$("#NewRePassword_Input").attr("placeholder","重复密码"),$("#NewUserMobile_Input").attr("placeholder","电话号码"),$("#NewUserMail_Input").attr("placeholder","邮箱"),$("#duallistboxUserAuth_new").empty();for(var e="",t=0;t<project_pg_list.length;t++)e="<option value='"+project_pg_list[t].id+"'>"+project_pg_list[t].name+"</option>",$("#duallistboxUserAuth_new").append(e);$(".NewUserAuthDual").bootstrapDualListbox("refresh",!0),modal_middle($("#newUserModal")),$("#newUserModal").modal("show")}function submit_new_user_module(){var e=$("#NewUsername_Input").val(),t=$("#NewUserNick_Input").val(),o=$("#NewPassword_Input").val(),a=$("#NewRePassword_Input").val(),l=$("#NewUserMobile_Input").val(),n=$("#NewUserMail_Input").val(),i=$("#NewUserMemo_Input").val();if(null===e||""===e)return $("#NewUsername_Input").attr("placeholder","用户名不能为空"),void $("#NewUsername_Input").focus();if(null===o||""===o)return $("#NewPassword_Input").attr("placeholder","密码不能为空"),$("#NewRePassword_Input").attr("placeholder","密码不能为空"),void $("#NewPassword_Input").focus();if(o!=a)return $("#NewPassword_Input").val(""),$("#NewRePassword_Input").val(""),$("#NewPassword_Input").attr("placeholder","密码不正确，请重新输入"),$("#NewRePassword_Input").attr("placeholder","密码不正确，请重新输入"),void $("#NewPassword_Input").focus();if(null===l||""===l)return $("#NewUserMobile_Input").attr("placeholder","电话号码不能为空"),void $("#NewUserMobile_Input").focus();if(null===n||""===n)return $("#NewUserMail_Input").attr("placeholder","邮箱不能为空"),void $("#NewUserMail_Input").focus();var d={name:e,nickname:t,password:a,mobile:l,mail:n,type:$("#NewUserType_choice").val(),memo:i},r=[];$("#duallistboxUserAuth_new :selected").each(function(e,t){var o={id:$(t).val(),name:$(t).text()};r.push(o)}),console.log(r),new_user(d,r)}function show_mod_user_module(e,t){$("#newModalLabel").text("用户信息修改：密码栏不输入表示不修改密码"),user_module_status=!1,$("#NewUsername_Input").val(e.name),$("#NewUserNick_Input").val(e.nickname),$("#NewPassword_Input").val(""),$("#NewRePassword_Input").val(""),$("#NewUserMobile_Input").val(e.mobile),$("#NewUserMail_Input").val(e.mail),$("#NewUserMemo_Input").val(e.memo),$("#NewUsername_Input").attr("placeholder","用户名"),$("#NewPassword_Input").attr("placeholder","密码"),$("#NewRePassword_Input").attr("placeholder","重复密码"),$("#NewUserMobile_Input").attr("placeholder","电话号码"),$("#NewUserMail_Input").attr("placeholder","邮箱"),e.type===!1?$("#NewUserType_choice").val("false"):$("#NewUserType_choice").val("true"),$("#duallistboxUserAuth_new").empty();for(var o="",a=0;a<project_pg_list.length;a++){o="<option value='"+project_pg_list[a].id+"'";for(var l=0;l<t.length;l++)if(t[l].id==project_pg_list[a].id){o+="selected='selected'";break}o=o+">"+project_pg_list[a].name+"</option>",$("#duallistboxUserAuth_new").append(o)}$(".NewUserAuthDual").bootstrapDualListbox("refresh",!0),modal_middle($("#newUserModal")),$("#newUserModal").modal("show")}function submit_mod_user_module(){var e=$("#NewUsername_Input").val(),t=$("#NewUserNick_Input").val(),o=$("#NewPassword_Input").val(),a=$("#NewRePassword_Input").val(),l=$("#NewUserMobile_Input").val(),n=$("#NewUserMail_Input").val(),i=$("#NewUserMemo_Input").val();if(""!==o&&""!==a&&o!=a)return $("#NewPassword_Input").val(""),$("#NewRePassword_Input").val(""),$("#NewPassword_Input").attr("placeholder","密码不正确，请重新输入"),$("#NewRePassword_Input").attr("placeholder","密码不正确，请重新输入"),void $("#NewPassword_Input").focus();var d={id:user_selected.id,name:e,nickname:t,password:a,mobile:l,mail:n,type:$("#NewUserType_choice").val(),memo:i},r=[];$("#duallistboxUserAuth_new :selected").each(function(e,t){var o={id:$(t).val(),name:$(t).text()};r.push(o)}),modify_user(d,r)}function get_project_list(){var e={action:"ProjectList",user:usr.id},t=function(e){return"false"==e.status?void show_expiredModule():void(project_list=e.ret)};JQ_get(request_head,e,t)}function get_pg_table(e,t){var o={action:"PGTable",startseq:e,length:t,user:usr.id},a=function(e){return"false"==e.status?void show_expiredModule():(pg_table=e.ret,pg_start=parseInt(e.start),pg_total=parseInt(e.total),void draw_pg_table_head())};JQ_get(request_head,o,a)}function del_pg(e){var t={action:"PGDel",id:e,user:usr.id},o=function(e){var t=e.status;"true"==t?(show_alarm_module(!1,"删除成功！"),clear_pg_detail_panel(),pg_intialize(0)):show_alarm_module(!0,"删除失败！"+e.msg)};JQ_get(request_head,t,o),$("#PGDelAlarm").modal("hide")}function new_pg(e,t){var o={action:"PGNew",PGCode:e.PGCode,PGName:e.PGName,ChargeMan:e.ChargeMan,Telephone:e.Telephone,Department:e.Department,Address:e.Address,Stage:e.Stage,Projlist:t,user:usr.id},a=function(e){var t=e.status;"true"==t?(show_alarm_module(!1,"创建成功！"),$("#newPGModal").modal("hide"),clear_pg_detail_panel(),pg_intialize(0)):show_alarm_module(!0,"创建失败！"+e.msg)};JQ_get(request_head,o,a)}function modify_pg(e,t){var o={action:"PGMod",PGCode:e.PGCode,PGName:e.PGName,ChargeMan:e.ChargeMan,Telephone:e.Telephone,Department:e.Department,Address:e.Address,Stage:e.Stage,Projlist:t,user:usr.id},a=function(e){var t=e.status;"true"==t?(show_alarm_module(!1,"修改成功！"),$("#newPGModal").modal("hide"),clear_pg_detail_panel(),pg_intialize(0)):show_alarm_module(!0,"修改失败！"+e.msg)};JQ_get(request_head,o,a)}function get_pg_proj(e){var t={action:"PGProj",id:e},o=function(e){return"false"==e.status?void show_expiredModule():(pg_selected_proj=e.ret,void draw_pg_detail_panel())};JQ_get(request_head,t,o)}function pg_intialize(e){null===project_list&&get_project_list(),pg_initial=!0,pg_table=null,get_pg_table(e,5*table_row),clear_pg_detail_panel()}function draw_pg_table_head(){if(null!==pg_table){var e=Math.ceil(pg_table.length/table_row);$("#PG_Page_control").empty();var t,o="<li><a href='#' id='pg_page_prev'>Prev</a></li>",a=Math.ceil(pg_start/table_row);for(t=0;t<e;t++)o=o+"<li><a href='#' id='pg_page_"+t+"'>"+(t+a+1)+"</a></li>";for(o+="<li><a href='#' id='pg_page_next'>Next</a></li>",$("#PG_Page_control").append(o),table_head="<thead><tr><th>编号</th> <th>名称 </th> <th>责任人 </th> <th>电话 </th> <th>单位 </th>",table_head+="</tr></thread>",pg_page_click=function(){draw_pg_table($(this))},t=0;t<e;t++)$("#pg_page_"+t).on("click",pg_page_click);pg_start<=0?$("#pg_page_prev").css("display","none"):($("#pg_page_prev").css("display","block"),$("#pg_page_prev").on("click",function(){var e=pg_start-5*table_row;e<0&&(e=0),pg_intialize(e)})),pg_start+5*table_row>=pg_total?$("#pg_page_next").css("display","none"):($("#pg_page_next").css("display","block"),$("#pg_page_next").on("click",function(){pg_intialize(pg_start+5*table_row)})),draw_pg_table($("#pg_page_0"))}}function draw_pg_table(e){if($("#Table_pg").empty(),null!==pg_table){var t=(parseInt(e.html())-1)*table_row-pg_start,o=table_head;o+="<tbody>";var a;for(a=0;a<table_row;a++)t+a<pg_table.length?(o=0!==a%2?o+"<tr class='success  li_menu' id='pg_table_cell"+a+"' PGCode='"+pg_table[t+a].PGCode+"'>":o+"<tr class=' li_menu' id='pg_table_cell"+a+"' PGCode='"+pg_table[t+a].PGCode+"'>",o=o+"<td>"+pg_table[t+a].PGCode+"</td><td>"+pg_table[t+a].PGName+"</td><td>"+pg_table[t+a].ChargeMan+"</td><td>"+pg_table[t+a].Telephone+"</td>",o=o+"<td>"+pg_table[t+a].Department+"</td>",o+="</tr>"):(o=0!==a%2?o+"<tr class='success' id='pg_table_cell"+a+"' PGCode='null'>":o+"<tr  id='pg_table_cell"+a+"' PGCode='null'>",o+="<td>--</td><td>--</td><td>--</td><td>--</td><td>--</td><td>--</td>",o+="</tr>");for(o+="</tbody>",$("#Table_pg").append(o),pg_table_cell_click=function(){if("null"!=$(this).attr("PGCode")){for(var e=0;e<pg_table.length;e++)if($(this).attr("PGCode")==pg_table[e].PGCode){pg_selected=pg_table[e];break}Initialize_pg_detail(),touchcookie()}},a=0;a<table_row;a++)$("#pg_table_cell"+a).on("click",pg_table_cell_click);touchcookie()}}function Initialize_pg_detail(){get_pg_proj(pg_selected.PGCode)}function clear_pg_detail_panel(){pg_selected=null;var e="<p></p><p></p><div class='col-md-6 col-sm-6 col-xs-12 column'><dl ><dt >项目组编号：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd><dt >负责人：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd></dl></div><div class='col-md-6 col-sm-6 col-xs-12 column'><dl ><dt>项目组名称：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd><dt>电话：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd></dl></div><div class='col-md-12 col-sm-12 col-xs-12 column'><dl ><dt>单位：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd><dt>地址：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd><dt>备注：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd></dl></div>";$("#Label_pg_detail").empty(),$("#Label_pg_detail").append(e),$("#Table_pg_proj").empty()}function draw_pg_detail_panel(){if($("#Label_pg_detail").empty(),null!==pg_selected_proj){var e="<p></p><p></p><div class='col-md-6 col-sm-6 col-xs-12 column'><dl ><dt >项目组编号：</dt><dd>"+pg_selected.PGCode+"</dd><dt >负责人：</dt><dd>"+pg_selected.ChargeMan+"</dd></dl></div><div class='col-md-6 col-sm-6 col-xs-12 column'><dl ><dt>项目组名称：</dt><dd>"+pg_selected.PGName+"</dd><dt>电话：</dt><dd>"+pg_selected.Telephone+"</dd></dl></div><div class='col-md-12 col-sm-12 col-xs-12 column'><dl ><dt>单位：</dt><dd>"+pg_selected.Department+"</dd><dt>地址：</dt><dd>"+pg_selected.Address+"</dd><dt>备注：</dt><dd>"+pg_selected.Stage+"</dd></dl></div>";$("#Label_pg_detail").append(e),$("#Table_pg_proj").empty(),e="<thead> <tr> <th>下辖项目清单 </th> </tr> </thead> <tbody >";for(var t=0;t<pg_selected_proj.length;t++)e=e+"<tr> <td>"+pg_selected_proj[t].name+"</td> </tr>";e+="</tbody>",$("#Table_pg_proj").append(e)}}function show_new_pg_module(){$("#newPGModalLabel").text("创建新项目组"),pg_module_status=!0,$("#PGPGCode_Input").val(""),$("#PGPGCode_Input").attr("disabled",!1),$("#PGPGName_Input").val(""),$("#PGChargeMan_Input").val(""),$("#PGTelephone_Input").val(""),$("#PGDepartment_Input").val(""),$("#PGAddress_Input").val(""),$("#PGStage_Input").val(""),$("#PGPGCode_Input").attr("placeholder","项目组编号"),$("#PGPGName_Input").attr("placeholder","项目组名称"),$("#PGChargeMan_Input").attr("placeholder","负责人姓名"),$("#PGTelephone_Input").attr("placeholder","联系电话"),$("#PGDepartment_Input").attr("placeholder","单位名称"),$("#PGAddress_Input").attr("placeholder","地址"),$("#duallistboxPGProj_new").empty();for(var e="",t=0;t<project_list.length;t++)e="<option value='"+project_list[t].id+"'>"+project_list[t].name+"</option>",$("#duallistboxPGProj_new").append(e);$(".NewPGProjDual").bootstrapDualListbox("refresh",!0),modal_middle($("#newPGModal")),$("#newPGModal").modal("show")}function submit_new_pg_module(){var e=$("#PGPGCode_Input").val(),t=$("#PGPGName_Input").val(),o=$("#PGChargeMan_Input").val(),a=$("#PGTelephone_Input").val(),l=$("#PGDepartment_Input").val(),n=$("#PGAddress_Input").val(),i=$("#PGStage_Input").val();if(null===e||""===e)return $("#PGPGCode_Input").attr("placeholder","项目组号不能为空"),void $("#PGPGCode_Input").focus();if(null===t||""===t)return $("#PGPGName_Input").attr("placeholder","项目组名称不能为空"),void $("#PGPGName_Input").focus();if(null===o||""===o)return $("#PGChargeMan_Input").attr("placeholder","负责人姓名不能为空"),void $("#PGChargeMan_Input").focus();if(null===a||""===a)return $("#PGTelephone_Input").attr("placeholder","联系电话不能为空"),void $("#PGTelephone_Input").focus();if(null===l||""===l)return $("#PGDepartment_Input").attr("placeholder","单位名称不能为空"),void $("#PGDepartment_Input").focus();if(null===n||""===n)return $("#PGAddress_Input").attr("placeholder","地址不能为空"),void $("#PGAddress_Input").focus();var d={PGCode:e,PGName:t,ChargeMan:o,Telephone:a,Department:l,Address:n,Stage:i},r=[];$("#duallistboxPGProj_new :selected").each(function(e,t){var o={id:$(t).val(),name:$(t).text()};r.push(o)}),new_pg(d,r)}function show_mod_pg_module(e,t){$("#newPGModalLabel").text("项目组修改"),pg_module_status=!1,$("#PGPGCode_Input").val(e.PGCode),$("#PGPGCode_Input").attr("disabled",!0),$("#PGPGName_Input").val(e.PGName),$("#PGChargeMan_Input").val(e.ChargeMan),$("#PGTelephone_Input").val(e.Telephone),$("#PGDepartment_Input").val(e.Department),$("#PGAddress_Input").val(e.Address),$("#PGStage_Input").val(e.Stage),$("#PGPGCode_Input").attr("placeholder","项目号"),$("#PGPGName_Input").attr("placeholder","项目名称"),$("#PGChargeMan_Input").attr("placeholder","负责人姓名"),$("#PGTelephone_Input").attr("placeholder","联系电话"),$("#PGDepartment_Input").attr("placeholder","单位名称"),$("#PGAddress_Input").attr("placeholder","地址"),$("#duallistboxPGProj_new").empty();for(var o="",a=0;a<project_list.length;a++){o="<option value='"+project_list[a].id+"'";for(var l=0;l<t.length;l++)if(t[l].id==project_list[a].id){o+="selected='selected'";break}o=o+">"+project_list[a].name+"</option>",$("#duallistboxPGProj_new").append(o)}$(".NewPGProjDual").bootstrapDualListbox("refresh",!0),modal_middle($("#newPGModal")),$("#newPGModal").modal("show")}function submit_mod_pg_module(){var e=$("#PGPGCode_Input").val(),t=$("#PGPGName_Input").val(),o=$("#PGChargeMan_Input").val(),a=$("#PGTelephone_Input").val(),l=$("#PGDepartment_Input").val(),n=$("#PGAddress_Input").val(),i=$("#PGStage_Input").val(),d={PGCode:e,PGName:t,ChargeMan:o,Telephone:a,Department:l,Address:n,Stage:i},r=[];$("#duallistboxPGProj_new :selected").each(function(e,t){var o={id:$(t).val(),name:$(t).text()};r.push(o)}),modify_pg(d,r)}function get_key_table(e,t){var o={action:"KeyTable",startseq:e,length:t,user:usr.id},a=function(e){return"false"==e.status?void show_expiredModule():(key_table=e.ret,key_start=parseInt(e.start),key_total=parseInt(e.total),void draw_key_table_head())};JQ_get(request_head,o,a)}function del_key(e){var t={action:"KeyDel",id:e,user:usr.id},o=function(e){var t=e.status;"true"==t?(show_alarm_module(!1,"删除成功！"),clear_key_detail_panel(),key_intialize(0)):show_alarm_module(!0,"删除失败！"+e.msg)};JQ_get(request_head,t,o),$("#KeyDelAlarm").modal("hide")}function new_key(e){var t={action:"KeyNew",KeyCode:e.KeyCode,KeyName:e.KeyName,KeyProj:e.KeyProj,KeyType:e.KeyType,HardwareCode:e.HardwareCode,Memo:e.Memo,user:usr.id},o=function(e){var t=e.status;"true"==t?(show_alarm_module(!1,"创建成功！"),$("#newKeyModal").modal("hide"),clear_key_detail_panel(),key_intialize(0)):show_alarm_module(!0,"创建失败！"+e.msg)};JQ_get(request_head,t,o)}function modify_key(e){var t={action:"KeyMod",KeyCode:e.KeyCode,KeyName:e.KeyName,KeyProj:e.KeyProj,KeyType:e.KeyType,HardwareCode:e.HardwareCode,Memo:e.Memo,user:usr.id},o=function(e){var t=e.status;"true"==t?(show_alarm_module(!1,"修改成功！"),$("#newKeyModal").modal("hide"),clear_key_detail_panel(),key_intialize(0)):show_alarm_module(!0,"修改失败！"+e.msg)};JQ_get(request_head,t,o)}function get_key_auth(e){var t={action:"KeyAuthlist",KeyId:e},o=function(e){return"false"==e.status?void show_expiredModule():(key_selected_auth=e.ret,void draw_key_detail_auth_table())};JQ_get(request_head,t,o)}function key_intialize(e){null===project_list&&get_project_list(),key_initial=!0,key_table=null,get_key_table(e,5*table_row),clear_key_detail_panel()}function draw_key_table_head(){if(null!==key_table){var e=Math.ceil(key_table.length/table_row);$("#Key_Page_control").empty();var t,o="<li><a href='#' id='key_page_prev'>Prev</a></li>",a=Math.ceil(key_start/table_row);for(t=0;t<e;t++)o=o+"<li><a href='#' id='key_page_"+t+"'>"+(t+a+1)+"</a></li>";for(o+="<li><a href='#' id='key_page_next'>Next</a></li>",$("#Key_Page_control").append(o),table_head="<thead><tr><th>编号</th> <th>名称 </th> <th>归口部门 </th> <th>使用人 </th> <th>种类 </th>",table_head+="</tr></thread>",key_page_click=function(){draw_key_table($(this))},t=0;t<e;t++)$("#key_page_"+t).on("click",key_page_click);key_start<=0?$("#key_page_prev").css("display","none"):($("#key_page_prev").css("display","block"),$("#key_page_prev").on("click",function(){var e=key_start-5*table_row;e<0&&(e=0),key_intialize(e)})),key_start+5*table_row>=key_total?$("#key_page_next").css("display","none"):($("#key_page_next").css("display","block"),$("#key_page_next").on("click",function(){key_intialize(key_start+5*table_row)})),draw_key_table($("#key_page_0"))}}function key_type_transfer(e){return"R"==e?"射频卡":"B"==e?"蓝牙":"U"==e?"用户名":"I"==e?"身份证":"W"==e?"微信号":"P"==e?"电话号码":"未知类型"}function draw_key_table(e){if($("#Table_key").empty(),null!==key_table){var t=(parseInt(e.html())-1)*table_row-key_start,o=table_head;o+="<tbody>";var a;for(a=0;a<table_row;a++)t+a<key_table.length?(o=0!==a%2?o+"<tr class='success  li_menu' id='key_table_cell"+a+"' KeyCode='"+key_table[t+a].KeyCode+"'>":o+"<tr class=' li_menu' id='key_table_cell"+a+"' KeyCode='"+key_table[t+a].KeyCode+"'>",o=o+"<td>"+key_table[t+a].KeyCode+"</td><td>"+key_table[t+a].KeyName+"</td><td>"+key_table[t+a].KeyProjName+"</td><td>"+key_table[t+a].KeyUserName+"</td><td>"+key_type_transfer(key_table[t+a].KeyType)+"</td>",o+="</tr>"):(o=0!==a%2?o+"<tr class='success' id='key_table_cell"+a+"' KeyCode='null'>":o+"<tr  id='key_table_cell"+a+"' KeyCode='null'>",o+="<td>--</td><td>--</td><td>--</td><td>--</td><td>--</td>",o+="</tr>");for(o+="</tbody>",$("#Table_key").append(o),key_table_cell_click=function(){if("null"!=$(this).attr("KeyCode")){for(var e=0;e<key_table.length;e++)if($(this).attr("KeyCode")==key_table[e].KeyCode){key_selected=key_table[e];break}Initialize_key_detail(),touchcookie()}},a=0;a<table_row;a++)$("#key_table_cell"+a).on("click",key_table_cell_click);touchcookie()}}function Initialize_key_detail(){draw_key_detail_panel(),get_key_auth(key_selected.KeyCode)}function clear_key_detail_panel(){key_selected=null;var e="<p></p><p></p><div class='col-md-6 col-sm-6 col-xs-12 column'><dl ><dt >钥匙编号：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd><dt >钥匙名称：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd></dl></div><div class='col-md-6 col-sm-6 col-xs-12 column'><dl ><dt>归口部门：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd><dt>使用人：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd></dl></div><div class='col-md-12 col-sm-12 col-xs-12 column'><dl ><dt>钥匙种类：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd><dt>硬件码：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd><dt>备注：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd></dl></div>";
$("#Label_key_detail").empty(),$("#Label_key_detail").append(e),$("#Table_key_auth").empty()}function draw_key_detail_panel(){$("#Label_key_detail").empty();var e="<p></p><p></p><div class='col-md-6 col-sm-6 col-xs-12 column'><dl ><dt >钥匙编号：</dt><dd>"+key_selected.KeyCode+"</dd><dt >钥匙名称：</dt><dd>"+key_selected.KeyName+"</dd></dl></div><div class='col-md-6 col-sm-6 col-xs-12 column'><dl ><dt>归口部门：</dt><dd>"+key_selected.KeyProjName+"</dd><dt>使用人：</dt><dd>"+key_selected.KeyUserName+"</dd></dl></div><div class='col-md-12 col-sm-12 col-xs-12 column'><dl ><dt>钥匙种类：</dt><dd>"+key_type_transfer(key_selected.KeyType)+"</dd><dt>硬件码：</dt><dd>"+key_selected.HardwareCode+"</dd><dt>备注：</dt><dd>"+key_selected.Memo+"</dd></dl></div>";$("#Label_key_detail").append(e)}function draw_key_detail_auth_table(){$("#Table_key_auth").empty(),txt="<thead> <tr> <th>授权设备 </th> <th>授权方式 </th></tr> </thead> <tbody >";for(var e=0;e<key_selected_auth.length;e++)txt=txt+"<tr> <td>"+key_selected_auth[e].DomainName+"</td> <td>"+key_selected_auth[e].AuthWay+"</td></tr>";txt+="</tbody>",$("#Table_key_auth").append(txt)}function build_key_module_proj_choice(){if(null!==project_list){var e="";for(i=0;i<project_list.length;i++)e=e+"<option value="+project_list[i].id+">"+project_list[i].name+"</option>";$("#NewKeyProj_choice").append(e)}}function show_new_key_module(){$("#newKeyModalLabel").text("创建新钥匙"),build_key_module_proj_choice(),key_module_status=!0,$("#NewKeyName_Input").val(""),$("#NewKeyHardwareID_Input").val(""),$("#NewKeyMemo_Input").val(""),$("#NewKeyName_Input").attr("placeholder","钥匙名称"),$("#NewKeyHardwareID_Input").attr("placeholder","硬件码"),$("#NewKeyMemo_Input").attr("placeholder","备注"),modal_middle($("#newKeyModal")),$("#newKeyModal").modal("show")}function submit_new_key_module(){var e="",t=$("#NewKeyName_Input").val(),o=$("#NewKeyType_choice").val(),a=$("#NewKeyProj_choice").val(),l=$("#NewKeyHardwareID_Input").val(),n=$("#NewKeyMemo_Input").val();if(null===t||""===t)return $("#NewKeyName_Input").attr("placeholder","钥匙名称不能为空"),void $("#NewKeyName_Input").focus();if(null===l||""===l)return $("#NewKeyHardwareID_Input").attr("placeholder","硬件码不能为空"),void $("#NewKeyHardwareID_Input").focus();var i={KeyCode:e,KeyName:t,KeyType:o,KeyProj:a,HardwareCode:l,Memo:n};new_key(i)}function show_mod_key_module(e){build_key_module_proj_choice(),$("#newkeyModalLabel").text("钥匙修改"),key_module_status=!1,$("#NewKeyName_Input").val(e.KeyName),$("#NewKeyHardwareID_Input").val(e.HardwareCode),$("#NewKeyMemo_Input").val(e.Memo),$("#NewKeyName_Input").attr("placeholder","钥匙名称"),$("#NewKeyHardwareID_Input").attr("placeholder","硬件码"),$("#NewKeyMemo_Input").attr("placeholder","备注"),$("#NewKeyType_choice").val(e.KeyType),$("#NewKeyProj_choice").val(e.KeyProj),modal_middle($("#newKeyModal")),$("#newKeyModal").modal("show")}function submit_mod_key_module(){var e=key_selected.KeyCode,t=$("#NewKeyName_Input").val(),o=$("#NewKeyType_choice").val(),a=$("#NewKeyProj_choice").val(),l=$("#NewKeyHardwareID_Input").val(),n=$("#NewKeyMemo_Input").val();if(null===t||""===t)return $("#NewKeyName_Input").attr("placeholder","钥匙名称不能为空"),void $("#NewKeyName_Input").focus();if(null===l||""===l)return $("#NewKeyHardwareID_Input").attr("placeholder","硬件码不能为空"),void $("#NewKeyHardwareID_Input").focus();var i={KeyCode:e,KeyName:t,KeyType:o,KeyProj:a,HardwareCode:l,Memo:n};modify_key(i)}function get_proj_table(e,t){var o={action:"ProjTable",startseq:e,length:t,user:usr.id},a=function(e){return"false"==e.status?void show_expiredModule():(project_table=e.ret,project_start=parseInt(e.start),project_total=parseInt(e.total),void draw_proj_table_head())};JQ_get(request_head,o,a)}function del_proj(e){var t={action:"ProjDel",ProjCode:e,user:usr.id},o=function(e){var t=e.status;"true"==t?(show_alarm_module(!1,"删除成功！"),clear_proj_detail_panel(),proj_intialize(0)):show_alarm_module(!0,"删除失败！"+e.msg)};JQ_get(request_head,t,o),$("#ProjDelAlarm").modal("hide")}function new_proj(e){var t={action:"ProjNew",ProjCode:e.ProjCode,ProjName:e.ProjName,ChargeMan:e.ChargeMan,Telephone:e.Telephone,Department:e.Department,Address:e.Address,ProStartTime:e.ProStartTime,Stage:e.Stage,user:usr.id},o=function(e){var t=e.status;"true"==t?(show_alarm_module(!1,"创建成功！"),$("#newProjModal").modal("hide"),clear_proj_detail_panel(),proj_intialize(0)):show_alarm_module(!0,"创建失败！"+e.msg)};JQ_get(request_head,t,o)}function modify_proj(e){var t={action:"ProjMod",ProjCode:e.ProjCode,ProjName:e.ProjName,ChargeMan:e.ChargeMan,Telephone:e.Telephone,Department:e.Department,Address:e.Address,ProStartTime:e.ProStartTime,Stage:e.Stage,user:usr.id},o=function(e){var t=e.status;"true"==t?(show_alarm_module(!1,"修改成功！"),$("#newProjModal").modal("hide"),clear_proj_detail_panel(),proj_intialize(0)):show_alarm_module(!0,"修改失败！"+e.msg)};JQ_get(request_head,t,o)}function get_proj_point(e){var t={action:"PointProj",ProjCode:e},o=function(e){return"false"==e.status?void show_expiredModule():(project_selected_point=e.ret,void draw_proj_detail_point_table())};JQ_get(request_head,t,o)}function get_proj_key(e){var t={action:"ProjKey",ProjCode:e},o=function(e){return"false"==e.status?void show_expiredModule():(project_selected_key=e.ret,void draw_proj_detail_key_table())};JQ_get(request_head,t,o)}function proj_intialize(e){project_initial=!0,project_table=null,get_proj_table(e,5*table_row)}function draw_proj_table_head(){if(null!==project_table){var e=Math.ceil(project_table.length/table_row);$("#Proj_Page_control").empty();var t,o="<li><a href='#' id='proj_page_prev'>Prev</a></li>",a=Math.ceil(project_start/table_row);for(t=0;t<e;t++)o=o+"<li><a href='#' id='proj_page_"+t+"'>"+(t+a+1)+"</a></li>";for(o+="<li><a href='#' id='proj_page_next'>Next</a></li>",$("#Proj_Page_control").append(o),table_head="<thead><tr><th>编号</th> <th>名称 </th> <th>责任人 </th> <th>电话 </th> <th>单位 </th>",table_head+="</tr></thread>",proj_page_click=function(){draw_proj_table($(this))},t=0;t<e;t++)$("#proj_page_"+t).on("click",proj_page_click);project_start<=0?$("#proj_page_prev").css("display","none"):($("#proj_page_prev").css("display","block"),$("#proj_page_prev").on("click",function(){var e=project_start-5*table_row;e<0&&(e=0),proj_intialize(e)})),project_start+5*table_row>=project_total?$("#proj_page_next").css("display","none"):($("#proj_page_next").css("display","block"),$("#proj_page_next").on("click",function(){proj_intialize(project_start+5*table_row)})),draw_proj_table($("#proj_page_0"))}}function draw_proj_table(e){if($("#Table_proj").empty(),null!==project_table){var t=(parseInt(e.html())-1)*table_row-project_start,o=table_head;o+="<tbody>";var a;for(a=0;a<table_row;a++)t+a<project_table.length?(o=0!==a%2?o+"<tr class='success li_menu' id='proj_table_cell"+a+"' ProjCode='"+project_table[t+a].ProjCode+"'>":o+"<tr class=' li_menu' id='proj_table_cell"+a+"' ProjCode='"+project_table[t+a].ProjCode+"'>",o=o+"<td>"+project_table[t+a].ProjCode+"</td><td>"+project_table[t+a].ProjName+"</td><td>"+project_table[t+a].ChargeMan+"</td><td>"+project_table[t+a].Telephone+"</td><td>"+project_table[t+a].Department+"</td>",o+="</tr>"):(o=0!==a%2?o+"<tr class='success' id='proj_table_cell"+a+"' ProjCode='null'>":o+"<tr  id='proj_table_cell"+a+"' ProjCode='null'>",o+="<td>--</td><td>--</td><td>--</td><td>--</td><td>--</td>",o+="</tr>");for(o+="</tbody>",$("#Table_proj").append(o),proj_table_cell_click=function(){if("null"!=$(this).attr("ProjCode")){for(var e=0;e<project_table.length;e++)if($(this).attr("ProjCode")==project_table[e].ProjCode){project_selected=project_table[e];break}Initialize_proj_detail(),touchcookie()}},a=0;a<table_row;a++)$("#proj_table_cell"+a).on("click",proj_table_cell_click);touchcookie()}}function Initialize_proj_detail(){draw_proj_detail_panel(),get_proj_point(project_selected.ProjCode),get_proj_key(project_selected.ProjCode)}function clear_proj_detail_panel(){project_selected=null;var e="<p></p><p></p><div class='col-md-6 col-sm-6 col-xs-12 column'><dl ><dt >项目编号：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd><dt >负责人：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd></dl></div><div class='col-md-6 col-sm-6 col-xs-12 column'><dl ><dt>项目名称：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd><dt>电话：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd></dl></div><div class='col-md-12 col-sm-12 col-xs-12 column'><dl ><dt>单位：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd><dt>地址：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd><dt>创建日期：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd><dt>备注：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd></dl></div>";$("#Label_proj_detail").empty(),$("#Label_proj_detail").append(e),$("#Table_proj_point").empty(),$("#Table_proj_key").empty()}function draw_proj_detail_panel(){if($("#Label_proj_detail").empty(),null!==project_selected_point){var e="<p></p><p></p><div class='col-md-6 col-sm-6 col-xs-12 column'><dl ><dt >项目编号：</dt><dd>"+project_selected.ProjCode+"</dd><dt >负责人：</dt><dd>"+project_selected.ChargeMan+"</dd></dl></div><div class='col-md-6 col-sm-6 col-xs-12 column'><dl ><dt>项目名称：</dt><dd>"+project_selected.ProjName+"</dd><dt>电话：</dt><dd>"+project_selected.Telephone+"</dd></dl></div><div class='col-md-12 col-sm-12 col-xs-12 column'><dl ><dt>单位：</dt><dd>"+project_selected.Department+"</dd><dt>地址：</dt><dd>"+project_selected.Address+"</dd><dt>创建日期：</dt><dd>"+project_selected.ProStartTime+"</dd><dt>备注：</dt><dd>"+project_selected.Stage+"</dd></dl></div>";$("#Label_proj_detail").append(e)}}function draw_proj_detail_point_table(){$("#Table_proj_point").empty(),txt="<thead> <tr> <th>站点清单 </th> </tr> </thead> <tbody >";for(var e=0;e<project_selected_point.length;e++)txt=txt+"<tr> <td>"+project_selected_point[e].name+"</td> </tr>";txt+="</tbody>",$("#Table_proj_point").append(txt)}function draw_proj_detail_key_table(){$("#Table_proj_key").empty(),txt="<thead> <tr> <th>钥匙名称 </th> <th>所有人 </th></tr> </thead> <tbody >";for(var e=0;e<project_selected_key.length;e++)txt=txt+"<tr id='"+project_selected_key[e].id+"' class='keyrow'> <td>"+project_selected_key[e].name+"</td> <td>"+project_selected_key[e].username+"</td></tr>";txt+="</tbody>",$("#Table_proj_key").append(txt),$(".keyrow").on("click",function(){var e=$(this).attr("id");void 0!==e&&""!==e&&get_key_auth_list(e)})}function show_new_proj_module(){$("#newProjModalLabel").text("创建新项目"),project_module_status=!0,$("#ProjProjCode_Input").val(""),$("#ProjProjCode_Input").attr("disabled",!1),$("#ProjProjName_Input").val(""),$("#ProjChargeMan_Input").val(""),$("#ProjTelephone_Input").val(""),$("#ProjDepartment_Input").val(""),$("#ProjAddress_Input").val(""),$("#ProjProStartTime_Input").val(""),$("#ProjStage_Input").val(""),$("#ProjProjCode_Input").attr("placeholder","项目号"),$("#ProjProjName_Input").attr("placeholder","项目名称"),$("#ProjChargeMan_Input").attr("placeholder","负责人姓名"),$("#ProjTelephone_Input").attr("placeholder","联系电话"),$("#ProjDepartment_Input").attr("placeholder","单位名称"),$("#ProjAddress_Input").attr("placeholder","地址"),$("#ProjProStartTime_Input").attr("placeholder","创建时间"),modal_middle($("#newProjModal")),$("#newProjModal").modal("show")}function submit_new_proj_module(){var e=$("#ProjProjCode_Input").val(),t=$("#ProjProjName_Input").val(),o=$("#ProjChargeMan_Input").val(),a=$("#ProjTelephone_Input").val(),l=$("#ProjDepartment_Input").val(),n=$("#ProjAddress_Input").val(),i=$("#ProjProStartTime_Input").val(),d=$("#ProjStage_Input").val();if(null===e||""===e)return $("#ProjProjCode_Input").attr("placeholder","项目号不能为空"),void $("#ProjProjCode_Input").focus();if(null===t||""===t)return $("#ProjProjName_Input").attr("placeholder","项目名称不能为空"),void $("#ProjProjName_Input").focus();if(null===o||""===o)return $("#ProjChargeMan_Input").attr("placeholder","负责人姓名不能为空"),void $("#ProjChargeMan_Input").focus();if(null===a||""===a)return $("#ProjTelephone_Input").attr("placeholder","联系电话不能为空"),void $("#ProjTelephone_Input").focus();if(null===l||""===l)return $("#ProjDepartment_Input").attr("placeholder","单位名称不能为空"),void $("#ProjDepartment_Input").focus();if(null===n||""===n)return $("#ProjAddress_Input").attr("placeholder","地址不能为空"),void $("#ProjAddress_Input").focus();if(null===i||""===i)return $("#ProjProStartTime_Input").attr("placeholder","创建时间不能为空"),void $("#ProjProStartTime_Input").focus();var r={ProjCode:e,ProjName:t,ChargeMan:o,Telephone:a,Department:l,Address:n,ProStartTime:i,Stage:d};new_proj(r)}function show_mod_proj_module(e){$("#newProjModalLabel").text("项目修改"),project_module_status=!1,$("#ProjProjCode_Input").val(e.ProjCode),$("#ProjProjCode_Input").attr("disabled",!0),$("#ProjProjName_Input").val(e.ProjName),$("#ProjChargeMan_Input").val(e.ChargeMan),$("#ProjTelephone_Input").val(e.Telephone),$("#ProjDepartment_Input").val(e.Department),$("#ProjAddress_Input").val(e.Address),$("#ProjProStartTime_Input").val(e.ProStartTime),$("#ProjStage_Input").val(e.Stage),$("#ProjProjCode_Input").attr("placeholder","项目号"),$("#ProjProjName_Input").attr("placeholder","项目名称"),$("#ProjChargeMan_Input").attr("placeholder","负责人姓名"),$("#ProjTelephone_Input").attr("placeholder","联系电话"),$("#ProjDepartment_Input").attr("placeholder","单位名称"),$("#ProjAddress_Input").attr("placeholder","地址"),$("#ProjProStartTime_Input").attr("placeholder","创建时间"),modal_middle($("#newProjModal")),$("#newProjModal").modal("show")}function submit_mod_proj_module(){var e=$("#ProjProjCode_Input").val(),t=$("#ProjProjName_Input").val(),o=$("#ProjChargeMan_Input").val(),a=$("#ProjTelephone_Input").val(),l=$("#ProjDepartment_Input").val(),n=$("#ProjAddress_Input").val(),i=$("#ProjProStartTime_Input").val(),d=$("#ProjStage_Input").val(),r={ProjCode:e,ProjName:t,ChargeMan:o,Telephone:a,Department:l,Address:n,ProStartTime:i,Stage:d};modify_proj(r)}function get_version_list(){var e={action:"GetVersionList"};get_version_list_callback=function(e){return"false"==e.status?void show_expiredModule():(software_version_list=e.ret,void window.setTimeout(draw_parameter_page,wait_time_middle))},JQ_get(request_head,e,get_version_list_callback)}function get_projdev_version(e){var t={action:"GetProjDevVersion",ProjCode:e},o=function(e){if("false"==e.status)return void show_expiredModule();var t=e.ret;$("#duallistboxDevUpdate").empty();for(var o="",a=0;a<t.length;a++)o="<option value='"+t[a].DevCode+"'",o=o+">"+t[a].DevCode+t[a].ProjName+t[a].version+"</option>",$("#duallistboxDevUpdate").append(o);$("#duallistboxDevUpdate").bootstrapDualListbox("refresh",!0)};JQ_get(request_head,t,o)}function update_version(){var e=get_update_dev_list(),t=$("#UpdateVersion_choice").val();if(0===e.length)return void show_alarm_module(!0,"没有选中的设备");var o={action:"UpdateDevVersion",id:usr.id,list:e,version:t},a=function(e){return"false"==e.status?void show_expiredModule():void show_alarm_module(!1,"设置成功，设备会在下个更新点更新")};JQ_get(request_head,o,a)}function parameter_initialize(){parameter_initial=!0,null===project_list&&get_project_list(),get_version_list()}function draw_parameter_page(){$("#UpdateProj_choice").empty(),$("#UpdateVersion_choice").empty();var e,t="";for(e=0;e<project_list.length;e++)t=t+"<option value="+project_list[e].id+">"+project_list[e].name+"</option>";for($("#UpdateProj_choice").append(t),t="",e=0;e<software_version_list.length;e++)t=t+"<option value="+software_version_list[e]+">"+software_version_list[e]+"</option>";$("#UpdateVersion_choice").append(t),$("#UpdateProj_choice").change(function(){get_projdev_version($("#UpdateProj_choice").val())}),get_projdev_version($("#UpdateProj_choice").val())}function get_update_dev_list(){var e=[];return $("#duallistboxDevUpdate :selected").each(function(t,o){e.push($(o).val())}),e}function get_point_table(e,t){var o={action:"PointTable",startseq:e,length:t,user:usr.id},a=function(e){return"false"==e.status?void show_expiredModule():(point_table=e.ret,point_start=parseInt(e.start),point_total=parseInt(e.total),void draw_point_table_head())};JQ_get(request_head,o,a)}function del_point(e){var t={action:"PointDel",StatCode:e,user:usr.id},o=function(e){var t=e.status;"true"==t?(show_alarm_module(!1,"删除成功！"),clear_point_detail_panel(),point_intialize(0)):show_alarm_module(!0,"删除失败！"+e.msg)};JQ_get(request_head,t,o),$("#PointDelAlarm").modal("hide")}function new_point(e){var t={action:"PointNew",StatCode:e.StatCode,StatName:e.StatName,ProjCode:e.ProjCode,ChargeMan:e.ChargeMan,Telephone:e.Telephone,Longitude:e.Longitude,Latitude:e.Latitude,Department:e.Department,Address:e.Address,Country:e.Country,Street:e.Street,Square:e.Square,ProStartTime:e.ProStartTime,Stage:e.Stage,user:usr.id},o=function(e){var t=e.status;"true"==t?(show_alarm_module(!1,"创建成功！"),$("#newPointModal").modal("hide"),clear_point_detail_panel(),point_intialize(0)):show_alarm_module(!0,"创建失败！"+e.msg)};JQ_get(request_head,t,o)}function modify_point(e){var t={action:"PointMod",StatCode:e.StatCode,StatName:e.StatName,ProjCode:e.ProjCode,ChargeMan:e.ChargeMan,Telephone:e.Telephone,Longitude:e.Longitude,Latitude:e.Latitude,Department:e.Department,Address:e.Address,Country:e.Country,Street:e.Street,Square:e.Square,ProStartTime:e.ProStartTime,Stage:e.Stage,user:usr.id},o=function(e){var t=e.status;"true"==t?(show_alarm_module(!1,"修改成功！"),$("#newPointModal").modal("hide"),clear_point_detail_panel(),point_intialize(0)):show_alarm_module(!0,"修改失败！"+e.msg)};JQ_get(request_head,t,o)}function get_point_device(e){var t={action:"PointDev",StatCode:e},o=function(e){return"false"==e.status?void show_expiredModule():(point_selected_device=e.ret,void draw_point_detail_panel())};JQ_get(request_head,t,o)}function point_intialize(e){point_initial=!0,point_table=null,get_project_list(),get_point_table(e,5*table_row),clear_point_detail_panel()}function draw_point_table_head(){if(null!==point_table){var e=Math.ceil(point_table.length/table_row);$("#Point_Page_control").empty();var t,o="<li><a href='#' id='point_page_prev'>Prev</a></li>",a=Math.ceil(point_start/table_row);for(t=0;t<e;t++)o=o+"<li><a href='#' id='point_page_"+t+"'>"+(t+a+1)+"</a></li>";for(o+="<li><a href='#' id='point_page_next'>Next</a></li>",$("#Point_Page_control").append(o),table_head="<thead><tr><th>编号</th> <th>名称 </th> <th>项目</th> <th>责任人 </th> <th>电话 </th> ",table_head+="</tr></thread>",point_page_click=function(){draw_point_table($(this))},t=0;t<e;t++)$("#point_page_"+t).on("click",point_page_click);point_start<=0?$("#point_page_prev").css("display","none"):($("#point_page_prev").css("display","block"),$("#point_page_prev").on("click",function(){var e=point_start-5*table_row;e<0&&(e=0),point_intialize(e)})),point_start+5*table_row>=point_total?$("#point_page_next").css("display","none"):($("#point_page_next").css("display","block"),$("#point_page_next").on("click",function(){point_intialize(point_start+5*table_row)})),draw_point_table($("#point_page_0"))}}function draw_point_table(e){if($("#Table_point").empty(),null!==point_table){var t=(parseInt(e.html())-1)*table_row-point_start,o=table_head;o+="<tbody>";var a;for(a=0;a<table_row;a++)if(t+a<point_table.length){for(var l="",n=0;n<project_list.length;n++)if(point_table[t+a].ProjCode==project_list[n].id){l=project_list[n].name;break}o=0!==a%2?o+"<tr class='success li_menu' id='point_table_cell"+a+"' StatCode='"+point_table[t+a].StatCode+"'>":o+"<tr class=' li_menu' id='point_table_cell"+a+"' StatCode='"+point_table[t+a].StatCode+"'>",o=o+"<td>"+point_table[t+a].StatCode+"</td><td>"+point_table[t+a].StatName+"</td><td>"+l+"</td><td>"+point_table[t+a].ChargeMan+"</td><td>"+point_table[t+a].Telephone+"</td>",o+="</tr>"}else o=0!==a%2?o+"<tr class='success' id='point_table_cell"+a+"' StatCode='null'>":o+"<tr  id='point_table_cell"+a+"' StatCode='null'>",o+="<td>--</td><td>--</td><td>--</td><td>--</td><td>--</td><td>--</td>",o+="</tr>";for(o+="</tbody>",$("#Table_point").append(o),point_table_cell_click=function(){if("null"!=$(this).attr("StatCode")){for(var e=0;e<point_table.length;e++)if($(this).attr("StatCode")==point_table[e].StatCode){point_selected=point_table[e];break}Initialize_point_detail(),touchcookie()}},a=0;a<table_row;a++)$("#point_table_cell"+a).on("click",point_table_cell_click);touchcookie()}}function Initialize_point_detail(){get_point_device(point_selected.StatCode)}function clear_point_detail_panel(){point_selected=null;var e="<p></p><p></p><div class='col-md-6 col-sm-6 col-xs-12 column'><dl ><dt >站点编号：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd><dt >负责人：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd></dl></div><div class='col-md-6 col-sm-6 col-xs-12 column'><dl ><dt>站点名称：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd><dt>电话：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd></dl></div><div class='col-md-12 col-sm-12 col-xs-12 column'><dl ><dt>关联项目：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd><dt>单位：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd></dl></div><div class='col-md-6 col-sm-6 col-xs-12 column'><dl ><dt >经度：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd><dt >区县：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd></dl></div><div class='col-md-6 col-sm-6 col-xs-12 column'><dl ><dt>纬度：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd><dt>街镇：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd></dl></div><div class='col-md-12 col-sm-12 col-xs-12 column'><dl ><dt>地址：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd><dt>备注：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd></dl></div>";$("#Label_point_detail").empty(),$("#Label_point_detail").append(e),$("#Table_point_device").empty()}function draw_point_detail_panel(){if($("#Label_point_detail").empty(),null!==point_selected_device){for(var e="",t=0;t<project_list.length;t++)if(point_selected.ProjCode==project_list[t].id){e=project_list[t].name;break}var o="<p></p><p></p><div class='col-md-6 col-sm-6 col-xs-12 column'><dl ><dt >站点编号：</dt><dd>"+point_selected.StatCode+"</dd><dt >负责人：</dt><dd>"+point_selected.ChargeMan+"</dd></dl></div><div class='col-md-6 col-sm-6 col-xs-12 column'><dl ><dt>站点名称：</dt><dd>"+point_selected.StatName+"</dd><dt>电话：</dt><dd>"+point_selected.Telephone+"</dd></dl></div><div class='col-md-12 col-sm-12 col-xs-12 column'><dl ><dt>关联项目：</dt><dd>"+e+"</dd><dt>单位：</dt><dd>"+point_selected.Department+"</dd></dl></div><div class='col-md-6 col-sm-6 col-xs-12 column'><dl ><dt >经度：</dt><dd>"+point_selected.Longitude+"</dd><dt >区县：</dt><dd>"+point_selected.Country+"</dd></dl></div><div class='col-md-6 col-sm-6 col-xs-12 column'><dl ><dt>纬度：</dt><dd>"+point_selected.Latitude+"</dd><dt>街镇：</dt><dd>"+point_selected.Street+"</dd></dl></div><div class='col-md-12 col-sm-12 col-xs-12 column'><dl ><dt>地址：</dt><dd>"+point_selected.Address+"</dd><dt>备注：</dt><dd>"+point_selected.Stage+"</dd></dl></div>";$("#Label_point_detail").append(o),$("#Table_point_device").empty(),o="<thead> <tr> <th>监控设备清单 </th> </tr> </thead> <tbody >";for(var a=0;a<point_selected_device.length;a++)o=o+"<tr> <td>"+point_selected_device[a].name+"</td> </tr>";o+="</tbody>",$("#Table_point_device").append(o)}}function show_new_point_module(){$("#newPointModalLabel").text("创建站点"),point_module_status=!0,$("#PointStatCode_Input").val(""),$("#PointStatCode_Input").attr("disabled",!1),$("#PointStatName_Input").val(""),$("#PointChargeMan_Input").val(""),$("#PointTelephone_Input").val(""),$("#PointLongitude_Input").val(""),$("#PointLatitude_Input").val(""),$("#PointDepartment_Input").val(""),$("#PointAddress_Input").val(""),$("#PointCountry_Input").val(""),$("#PointStreet_Input").val(""),$("#PointStage_Input").val(""),$("#PointProjCode_choice").empty(),$("#PointProjCode_choice").append(get_proj_option()),$("#PointStatCode_Input").attr("placeholder","站点号"),$("#PointStatName_Input").attr("placeholder","站点名称"),$("#PointChargeMan_Input").attr("placeholder","负责人姓名"),$("#PointTelephone_Input").attr("placeholder","联系电话"),$("#PointLongitude_Input").attr("placeholder","经度"),$("#PointLatitude_Input").attr("placeholder","纬度"),$("#PointDepartment_Input").attr("placeholder","单位名称"),$("#PointAddress_Input").attr("placeholder","地址"),$("#PointCountry_Input").attr("placeholder","区县"),$("#PointStreet_Input").attr("placeholder","街镇"),modal_middle($("#newPointModal")),$("#newPointModal").modal("show")}function submit_new_point_module(){var e=$("#PointStatCode_Input").val(),t=$("#PointStatName_Input").val(),o=$("#PointProjCode_choice").val(),a=$("#PointChargeMan_Input").val(),l=$("#PointTelephone_Input").val(),n=$("#PointLongitude_Input").val(),i=$("#PointLatitude_Input").val(),d=$("#PointDepartment_Input").val(),r=$("#PointAddress_Input").val(),_=$("#PointCountry_Input").val(),s=$("#PointStreet_Input").val(),c="0",u="1999-01-01",p=$("#PointStage_Input").val();if(null===e||""===e)return $("#PointStatCode_Input").attr("placeholder","站点号不能为空"),void $("#PointStatCode_Input").focus();if(null===t||""===t)return $("#PointStatName_Input").attr("placeholder","站点名称不能为空"),void $("#PointStatName_Input").focus();if(null===a||""===a)return $("#PointChargeMan_Input").attr("placeholder","负责人姓名不能为空"),void $("#PointChargeMan_Input").focus();if(null===o||""===o)return $("#PointProjCode_choice").attr("placeholder","项目不能为空"),void $("#PointProjCode_choice").focus();if(null===l||""===l)return $("#PointTelephone_Input").attr("placeholder","联系电话不能为空"),void $("#PointTelephone_Input").focus();if(null===n||""===n)return $("#PointLongitude_Input").attr("placeholder","经度不能为空"),void $("#PointLongitude_Input").focus();if(null===i||""===i)return $("#PointLatitude_Input").attr("placeholder","纬度不能为空"),void $("#PointLatitude_Input").focus();if(null===d||""===d)return $("#PointDepartment_Input").attr("placeholder","单位名称不能为空"),void $("#PointDepartment_Input").focus();if(null===r||""===r)return $("#PointAddress_Input").attr("placeholder","地址不能为空"),void $("#PointAddress_Input").focus();if(null===_||""===_)return $("#PointCountry_Input").attr("placeholder","区县不能为空"),void $("#PointCountry_Input").focus();if(null===s||""===s)return $("#PointStreet_Input").attr("placeholder","街镇不能为空"),void $("#PointStreet_Input").focus();var m={StatCode:e,StatName:t,ProjCode:o,ChargeMan:a,Telephone:l,Longitude:n,Latitude:i,Department:d,Address:r,Country:_,Street:s,Square:c,ProStartTime:u,Stage:p};new_point(m)}function show_mod_point_module(e){$("#newPointModalLabel").text("站点修改"),point_module_status=!1,$("#PointStatCode_Input").val(e.StatCode),$("#PointStatCode_Input").attr("disabled",!0),$("#PointStatName_Input").val(e.StatName),$("#PointChargeMan_Input").val(e.ChargeMan),$("#PointTelephone_Input").val(e.Telephone),$("#PointLongitude_Input").val(e.Longitude),$("#PointLatitude_Input").val(e.Latitude),$("#PointDepartment_Input").val(e.Department),$("#PointAddress_Input").val(e.Address),$("#PointCountry_Input").val(e.Country),$("#PointStreet_Input").val(e.Street),$("#PointSquare_Input").val(e.Square),$("#PointProjCode_choice").empty(),$("#PointProjCode_choice").append(get_proj_option()),$("#PointProjCode_choice").val(e.ProjCode),$("#PointStatCode_Input").attr("placeholder","站点号"),$("#PointStatName_Input").attr("placeholder","站点名称"),$("#PointChargeMan_Input").attr("placeholder","负责人姓名"),$("#PointTelephone_Input").attr("placeholder","联系电话"),$("#PointLongitude_Input").attr("placeholder","经度"),$("#PointLatitude_Input").attr("placeholder","纬度"),$("#PointDepartment_Input").attr("placeholder","单位名称"),$("#PointAddress_Input").attr("placeholder","地址"),$("#PointCountry_Input").attr("placeholder","区县"),$("#PointStreet_Input").attr("placeholder","街镇"),modal_middle($("#newPointModal")),$("#newPointModal").modal("show")}function submit_mod_point_module(){var e=$("#PointStatCode_Input").val(),t=$("#PointStatName_Input").val(),o=$("#PointProjCode_choice").val(),a=$("#PointChargeMan_Input").val(),l=$("#PointTelephone_Input").val(),n=$("#PointLongitude_Input").val(),i=$("#PointLatitude_Input").val(),d=$("#PointDepartment_Input").val(),r=$("#PointAddress_Input").val(),_=$("#PointCountry_Input").val(),s=$("#PointStreet_Input").val(),c="0",u="1999-01-01",p=$("#PointStage_Input").val(),m={StatCode:e,StatName:t,ProjCode:o,ChargeMan:a,Telephone:l,Longitude:n,Latitude:i,Department:d,Address:r,Country:_,Street:s,Square:c,ProStartTime:u,Stage:p};modify_point(m)}function get_proj_point_list(){var e={action:"ProjPoint"},t=function(e){return"false"==e.status?void show_expiredModule():void(point_list=e.ret)};JQ_get(request_head,e,t)}function get_dev_table(e,t){var o={action:"DevTable",startseq:e,length:t,user:usr.id},a=function(e){return"false"==e.status?void show_expiredModule():(device_table=e.ret,device_start=parseInt(e.start),device_total=parseInt(e.total),void window.setTimeout(draw_dev_table_head,wait_time_middle))};JQ_get(request_head,o,a)}function del_dev(e){var t={action:"DevDel",DevCode:e,user:usr.id},o=function(e){var t=e.status;"true"==t?(show_alarm_module(!1,"删除成功！"),clear_dev_detail_panel(),dev_intialize(0)):show_alarm_module(!0,"删除失败！"+e.msg)};JQ_get(request_head,t,o),$("#DevDelAlarm").modal("hide")}function new_dev(e){var t={action:"DevNew",DevCode:e.DevCode,StatCode:e.StatCode,StartTime:e.StartTime,PreEndTime:e.PreEndTime,EndTime:e.EndTime,DevStatus:e.DevStatus,VideoURL:e.VideoURL,user:usr.id},o=function(e){var t=e.status;"true"==t?(show_alarm_module(!1,"创建成功！"),$("#newDevModal").modal("hide"),clear_dev_detail_panel(),dev_intialize(0)):show_alarm_module(!0,"创建失败！"+e.msg)};JQ_get(request_head,t,o)}function modify_dev(e){var t={action:"DevMod",DevCode:e.DevCode,StatCode:e.StatCode,StartTime:e.StartTime,PreEndTime:e.PreEndTime,EndTime:e.EndTime,DevStatus:e.DevStatus,VideoURL:e.VideoURL,user:usr.id},o=function(e){var t=e.status;"true"==t?(show_alarm_module(!1,"修改成功！"),$("#newDevModal").modal("hide"),clear_dev_detail_panel(),dev_intialize(0)):show_alarm_module(!0,"修改失败！"+e.msg)};JQ_get(request_head,t,o)}function dev_intialize(e){device_initial=!0,device_table=null,get_dev_table(e,5*table_row),get_project_list(),get_proj_point_list(),clear_dev_detail_panel()}function draw_dev_table_head(){if(null!==device_table){var e=Math.ceil(device_table.length/table_row);$("#Dev_Page_control").empty();var t,o="<li><a href='#' id='dev_page_prev'>Prev</a></li>",a=Math.ceil(device_start/table_row);for(t=0;t<e;t++)o=o+"<li><a href='#' id='dev_page_"+t+"'>"+(t+a+1)+"</a></li>";for(o+="<li><a href='#' id='dev_page_next'>Next</a></li>",$("#Dev_Page_control").append(o),table_head="<thead><tr><th>编号 </th> <th>项目名称 </th> <th>站点名称 </th><th>安装时间 </th> <th>是否启动 </th>",table_head+="</tr></thread>",dev_page_click=function(){draw_dev_table($(this))},t=0;t<e;t++)$("#dev_page_"+t).on("click",dev_page_click);device_start<=0?$("#dev_page_prev").css("display","none"):($("#dev_page_prev").css("display","block"),$("#dev_page_prev").on("click",function(){var e=device_start-5*table_row;e<0&&(e=0),dev_intialize(e)})),device_start+5*table_row>=device_total?$("#dev_page_next").css("display","none"):($("#dev_page_next").css("display","block"),$("#dev_page_next").on("click",function(){dev_intialize(device_start+5*table_row)})),draw_dev_table($("#dev_page_0"))}}function draw_dev_table(e){if($("#Table_dev").empty(),null!==device_table){var t=(parseInt(e.html())-1)*table_row-device_start,o=table_head;o+="<tbody>";var a;for(a=0;a<table_row;a++)if(t+a<device_table.length){o=0!==a%2?o+"<tr class='success li_menu' id='dev_table_cell"+a+"' DevCode='"+device_table[t+a].DevCode+"'>":o+"<tr class=' li_menu' id='dev_table_cell"+a+"' DevCode='"+device_table[t+a].DevCode+"'>";var l="开启";"false"===device_table[t+a].DevStatus&&(l="关闭"),o=o+"<td>"+device_table[t+a].DevCode+"</td><td>"+get_proj_name(device_table[t+a].ProjCode)+"</td><td>"+get_point_name(device_table[t+a].StatCode)+"</td><td>"+device_table[t+a].StartTime+"</td><td>"+l+"</td>",o+="</tr>"}else o=0!==a%2?o+"<tr class='success' id='dev_table_cell"+a+"' DevCode='null'>":o+"<tr  id='dev_table_cell"+a+"' DevCode='null'>",o+="<td>--</td><td>--</td><td>--</td><td>--</td><td>--</td>",o+="</tr>";for(o+="</tbody>",$("#Table_dev").append(o),dev_table_cell_click=function(){if("null"!=$(this).attr("DevCode")){for(var e=0;e<device_table.length;e++)if($(this).attr("DevCode")==device_table[e].DevCode){device_selected=device_table[e];break}Initialize_dev_detail(),touchcookie()}},a=0;a<table_row;a++)$("#dev_table_cell"+a).on("click",dev_table_cell_click);touchcookie()}}function Initialize_dev_detail(){get_device_sensor(device_selected.DevCode)}function clear_dev_detail_panel(){project_selected=null;var e="<p></p><p></p><div class='col-md-12 col-sm-12 col-xs-12 column'><dl ><dt>设备编号：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd></dl></div><div class='col-md-6 col-sm-6 col-xs-12 column'><dl ><dt >项目：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd><dt >安装时间：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd><dt >MAC地址：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd></dl></div><div class='col-md-6 col-sm-6 col-xs-12 column'><dl ><dt>站点：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd><dt >IP地址：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd><dt >设备是否启动：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd></dl></div><div class='col-md-12 col-sm-12 col-xs-12 column'><dl ><dt>视频地址：</dt><dd>&nbsp&nbsp&nbsp&nbsp</dd></dl></div>";
$("#Label_dev_detail").empty(),$("#Label_dev_detail").append(e),$("#Table_device_sensor").empty()}function draw_dev_detail_panel(){if($("#Label_dev_detail").empty(),null!==device_selected_sensor){var e="开启";"false"===device_selected.DevStatus&&(e="关闭");var t="<p></p><p></p><div class='col-md-12 col-sm-12 col-xs-12 column'><dl ><dt>设备编号：</dt><dd>"+device_selected.DevCode+"</dd></dl></div><div class='col-md-6 col-sm-6 col-xs-12 column'><dl ><dt >项目：</dt><dd>"+get_proj_name(device_selected.ProjCode)+"</dd><dt >安装时间：</dt><dd>"+device_selected.StartTime+"</dd><dt >MAC地址：</dt><dd>"+device_selected.MAC+"</dd></dl></div><div class='col-md-6 col-sm-6 col-xs-12 column'><dl ><dt>站点：</dt><dd>"+get_point_name(device_selected.StatCode)+"</dd><dt >IP地址：</dt><dd>"+device_selected.IP+"</dd><dt >设备是否启动：</dt><dd>"+e+"</dd></dl></div><div class='col-md-12 col-sm-12 col-xs-12 column'><dl ><dt>视频地址：</dt><dd>"+device_selected.VideoURL+"</dd></dl></div>";$("#Label_dev_detail").append(t),$("#Table_device_sensor").empty(),t="<thead> <tr> <th>传感器 </th><th>状态 </th> </tr> </thead> <tbody >";var o;for(o=0;o<device_selected_sensor.length;o++){var a="开启";"false"==device_selected_sensor[o].status&&(a="关闭"),t=t+"<tr class=' li_menu' id='sensor_table_cell"+o+"' sequence='"+o+"'> <td>"+get_sensor_name(device_selected_sensor[o].id)+"</td><td>"+a+"</td> </tr>"}for($("#Table_device_sensor").append(t),sensor_table_cell_click=function(){"null"!=$(this).attr("sequence")&&(select_sensor=device_selected_sensor[parseInt($(this).attr("sequence"))],show_sensor_module())},o=0;o<device_selected_sensor.length;o++)$("#sensor_table_cell"+o).on("click",sensor_table_cell_click)}}function show_new_dev_module(){$("#newDevModalLabel").text("创建新设备"),device_module_status=!0,$("#DevDevCode_Input").attr("disabled",!1),$("#DevDevCode_Input").val(""),$("#DevStatCode_choice").empty(),$("#DevProjCode_choice").empty(),$("#DevProjCode_choice").append(get_proj_option()),get_proj_point_option($("#DevProjCode_choice").val(),$("#DevStatCode_choice"),""),$("#DevStartTime_Input").val(""),$("#DevDevStatus_choice").val("true"),$("#DevVideoURL_Input").val(""),$("#DevDevCode_Input").attr("placeholder","设备编号"),$("#DevStartTime_Input").attr("placeholder","安装时间"),modal_middle($("#newDevModal")),$("#newDevModal").modal("show")}function submit_new_dev_module(){var e=$("#DevDevCode_Input").val(),t=$("#DevStatCode_choice").val(),o=$("#DevStartTime_Input").val(),a="1999-01-01",l="1999-01-01",n=$("#DevDevStatus_choice").val(),i=$("#DevVideoURL_Input").val();if(null===e||""===e)return $("#DevDevCode_Input").attr("placeholder","设备号不能为空"),void $("#DevDevCode_Input").focus();if(null===t||""===t)return $("#DevStatCode_choice").attr("placeholder","项目不能为空"),void $("#DevStatCode_choice").focus();if(null===o||""===o)return $("#DevStartTime_Input").attr("placeholder","负责人姓名不能为空"),void $("#DevStartTime_Input").focus();var d={DevCode:e,StatCode:t,StartTime:o,PreEndTime:a,EndTime:l,DevStatus:n,VideoURL:i};new_dev(d)}function show_mod_dev_module(e){$("#newDevModalLabel").text("项目修改"),device_module_status=!1,$("#DevDevCode_Input").attr("disabled",!0),$("#DevDevCode_Input").val(e.DevCode),$("#DevStatCode_choice").empty(),$("#DevProjCode_choice").empty(),$("#DevProjCode_choice").append(get_proj_option(e.ProjCode)),get_proj_point_option($("#DevProjCode_choice").val(),$("#DevStatCode_choice"),e.StatCode),$("#DevStatCode_choice").val(e.StatCode),$("#DevStartTime_Input").val(e.StartTime),e.DevStatus?$("#DevDevStatus_choice").val("true"):$("#DevDevStatus_choice").val("false"),$("#DevVideoURL_Input").val(e.VideoURL),$("#DevDevCode_Input").attr("placeholder","设备编号"),$("#DevStartTime_Input").attr("placeholder","安装时间"),modal_middle($("#newDevModal")),$("#newDevModal").modal("show")}function submit_mod_dev_module(){var e=$("#DevDevCode_Input").val(),t=$("#DevStatCode_choice").val(),o=$("#DevStartTime_Input").val(),a="1999-01-01",l="1999-01-01",n=$("#DevDevStatus_choice").val(),i=$("#DevVideoURL_Input").val(),d={DevCode:e,StatCode:t,StartTime:o,PreEndTime:a,EndTime:l,DevStatus:n,VideoURL:i};modify_dev(d)}function get_proj_name(e){for(var t=null,o=0;o<project_list.length;o++)if(project_list[o].id==e){t=project_list[o].name;break}return t}function get_point_name(e){for(var t=null,o=0;o<point_list.length;o++)if(point_list[o].id==e){t=point_list[o].name;break}return t}function get_proj_option(e){txt="";for(var t=0;t<project_list.length;t++)project_list[t].id==e?txt=txt+"<option value="+project_list[t].id+" selected='selected'>"+project_list[t].name+"</option>":txt=txt+"<option value="+project_list[t].id+">"+project_list[t].name+"</option>";return txt}function get_proj_point_option(e,t,o){if(t.empty(),""!==e&&null!==e){for(var a="",l=0;l<point_list.length;l++)point_list[l].ProjCode==e&&(a=point_list[l].id==o?a+"<option value="+point_list[l].id+" selected='selected' >"+point_list[l].name+"</option>":a+"<option value="+point_list[l].id+">"+point_list[l].name+"</option>");t.empty(),t.append(a)}}function get_monitor_list(){var e={action:"MonitorList",id:usr.id},t=function(e){return"false"==e.status?void show_expiredModule():void(monitor_map_list=e.ret)};JQ_get(request_head,e,t)}function get_monitor_warning_on_map(){if(null!==monitor_selected&&null!==monitor_map_handle){var e={action:"DevAlarm",StatCode:monitor_selected.StatCode},t=function(e){if("false"==e.status)return void show_expiredModule();var t=e.ret,o="";if("false"==t)o="<Strong>获取告警失败</Strong>";else{o="<div id ='Element_card_floating' align='center' ><p style='font-size:14px;font-weight: bold' >站点名称："+monitor_selected.StatName+"</p><HR style='FILTER: alpha(opacity=100,finishopacity=0,style=3)' width='80%' color=#987cb9 SIZE=3/><div style='font-size:10px; min-height: 350px; min-width:420px' >",o+=" <div class='col-md-6 column'>";for(var a=0;a<t.length;a++){t[a].AlarmEName;o=o+"<img src='./svg/icon/"+t[a].AlarmEName+".svg' style='width:36px;hight:36px'></img><label style='max-width: 150px;min-width: 150px'>&nbsp&nbsp&nbsp&nbsp"+t[a].AlarmName+":";var l=t[a].AlarmValue,n=t[a].WarningTarget;o="true"==n?o+"<Strong style='color:red'>"+l+"</Strong>"+t[a].AlarmUnit+"</label>":o+"<Strong>"+l+"</Strong>"+t[a].AlarmUnit+"</label>",o+="<HR style='FILTER: alpha(opacity=100,finishopacity=0,style=3)' width='80%' color=#987cb9 SIZE=3/>",a==t.length/2-1&&(o+="</div><div class='col-md-6 column'>")}o+="</div></div>"}null!==monitor_map_handle&&monitor_map_handle.setContent(o),$("#VideoStatCode_Input").val(monitor_selected.StatName),video_selection_change()};JQ_get(request_head,e,t)}}function monitor_lock(){var e=monitor_selected.StatCode;void 0!==e&&show_openlockmodule(e)}function initializeMap(){get_monitor_list();var e=parseInt($("#MPMonitorViewMap").css("min-height").replace(/[^0-9]/gi,""));window.screen.availHeight-275>e&&(e=window.screen.availHeight-275),$("#MPMonitorViewMap").css("min-height",e+"px"),map_MPMonitor=new BMap.Map("MPMonitorViewMap"),map_MPMonitor.addControl(new BMap.NavigationControl),map_MPMonitor.enableScrollWheelZoom(),map_MPMonitor.centerAndZoom(usr.city,15),window.setTimeout(addMarker,wait_time_long),map_initialized=!0}function get_select_monitor(e){for(var t=e.split(":"),o=0;o<monitor_map_list.length;o++)if(monitor_map_list[o].StatCode==t[0])return void(monitor_selected=monitor_map_list[o]);monitor_selected=null}function addMarker(e){if(null!==monitor_map_list){var t=new BMap.Icon("./image/map-marker-ball-azure-small.png",new BMap.Size(32,32),{anchor:new BMap.Size(16,30)});monitor_mark_click=function(){get_select_monitor(this.getTitle());var e=this.getTitle(),t=new BMap.InfoWindow(e,{offset:new BMap.Size(0,(-23))});t.setWidth(600),monitor_map_handle=t,get_monitor_warning_on_map(),this.openInfoWindow(t),t.addEventListener("close",function(){monitor_map_handle==this&&(monitor_map_handle=null)})};for(var o=0;o<monitor_map_list.length;o++){var a=new BMap.Point(parseFloat(monitor_map_list[o].Longitude),parseFloat(monitor_map_list[o].Latitude)),l=new BMap.Marker(a,{icon:t});l.setTitle(monitor_map_list[o].StatCode+":"+monitor_map_list[o].StatName),map_MPMonitor.addOverlay(l),l.addEventListener("click",monitor_mark_click)}}}function video_selection_change(){null!==monitor_selected&&""!==$("#Video_query_Input").val()&&get_video(monitor_selected.StatCode,$("#Video_query_Input").val(),$("#VideoHour_choice").val())}function get_video(e,t,o){var a={action:"GetVideoList",id:usr.id,StatCode:e,date:t,hour:o},l=function(e){if("false"==e.status)return void show_expiredModule();var t=e.ret;$("#VCRStatus_choice").empty();for(var o="",a=0;a<t.length;a++)o=o+"<option value='"+t[a].id+"'>"+t[a].attr+"</option>";$("#VCRStatus_choice").append(o)};JQ_get(request_head,a,l)}function video_Module_selection_change(){""!==$("#VideoModuleStatCode_Input").val()&&""!==$("#VideoModule_query_Input").val()&&get_Module_video($("#VideoModuleStatCode_Input").val(),$("#VideoModule_query_Input").val(),$("#VideoModuleHour_choice").val())}function get_Module_video(e,t,o){var a={action:"GetVideoList",id:usr.id,StatCode:e,date:t,hour:o},l=function(e){if("false"==e.status)return void show_expiredModule();var t=e.ret;$("#ModuleVCRStatus_choice").empty();for(var o="",a=0;a<t.length;a++)o=o+"<option value='"+t[a].id+"'>"+t[a].attr+"</option>";$("#ModuleVCRStatus_choice").append(o)};JQ_get(request_head,a,l)}function initialize_warning_table(){$("#Monitor_Page_control").empty(),$("#Table_Monitor").empty();var e,t="<li><a href='#' id='monitor_page_prev'>Prev</a></li>",o=Math.ceil(monitor_map_list.length/(2*table_row));for(e=0;e<o;e++)t=t+"<li><a href='#' id='monitor_page_"+e+"' number='"+e+"'>"+(e+1)+"</a></li>";for(t+="<li><a href='#' id='monitor_page_next'>Next</a></li>",$("#Monitor_Page_control").append(t),Monitor_table_start=0,Monitor_table_total=o,0===Monitor_table_start?$("#monitor_page_prev").css("display","none"):$("#monitor_page_prev").css("display","block"),Monitor_table_start+5>=Monitor_table_total?$("#monitor_page_next").css("display","none"):$("#monitor_page_next").css("display","block"),e=0;e<o;e++)e<5?$("#monitor_page_"+e).css("display","block"):$("#monitor_page_"+e).css("display","none");for($("#monitor_page_next").on("click",function(){if(!(Monitor_table_start+5>=Monitor_table_total)){Monitor_table_start+=5;for(var e=0;e<Monitor_table_total;e++)$("#monitor_page_"+e).css("display","none"),e>=Monitor_table_start&&e<Monitor_table_start+5&&$("#monitor_page_"+e).css("display","block");0===Monitor_table_start?$("#monitor_page_prev").css("display","none"):$("#monitor_page_prev").css("display","block"),Monitor_table_start+5>=Monitor_table_total?$("#monitor_page_next").css("display","none"):$("#monitor_page_next").css("display","block"),show_monitor_page(Monitor_table_start)}}),$("#monitor_page_prev").on("click",function(){if(0!==Monitor_table_start){Monitor_table_start-=5,Monitor_table_start<0&&(Monitor_table_start=0);for(var e=0;e<Monitor_table_total;e++)$("#monitor_page_"+e).css("display","none"),e>=Monitor_table_start&&e<Monitor_table_start+5&&$("#monitor_page_"+e).css("display","block");0===Monitor_table_start?$("#monitor_page_prev").css("display","none"):$("#monitor_page_prev").css("display","block"),Monitor_table_start+5>=Monitor_table_total?$("#monitor_page_next").css("display","none"):$("#monitor_page_next").css("display","block"),show_monitor_page(Monitor_table_start)}}),monitor_page_click=function(){show_monitor_page(parseInt($(this).attr("number")))},e=0;e<o;e++)$("#monitor_page_"+e).on("click",monitor_page_click);Monitor_table_initialized=!0,show_monitor_page(0)}function show_monitor_page(e){$("#Table_Monitor").empty(),table_head="<thead><tr><th>站点名称 </th> <th>监控信息 </th></tr></thread>";var t=table_head;t+="<tbody>",sequence=e*table_row*2;for(var o=0;o<2*table_row;o++)sequence+o<monitor_map_list.length?(t+=0!==o%2?"<tr class='success' >":"<tr >",t=t+"<td>"+monitor_map_list[sequence+o].StatName+"</td><td id='Monitor_table_cell"+o+"' StatCode='"+monitor_map_list[sequence+o].StatCode+"'></td>",t+="</tr>"):(t+=0!==o%2?"<tr class='success'>":"<tr  >",t=t+"<td>--</td><td id='Monitor_table_cell"+o+"' DevCode='null'>--</td>",t+="</tr>");t+="</tbody>",$("#Table_Monitor").append(t),query_warning()}function build_monitor_message(e){var t="";if(null===e||void 0===e)return t;for(var o=0;o<e.length;o++)t=t+e[o].AlarmName+":","true"==e[o].WarningTarget&&(t+="<Strong style='color:red'>"),t=t+e[o].AlarmValue+" ","true"==e[o].WarningTarget&&(t+="</Strong>"),t=t+e[o].AlarmUnit+";";return t}function query_warning(){if(Monitor_table_initialized===!0){ajax_process=function(e){var t={action:"DevAlarm",StatCode:$("#Monitor_table_cell"+e).attr("StatCode")},o=function(e){var t="",o=e.StatCode;t="false"==e.status?"<Strong style='color:red'>未找到对应监控信息</Strong>":build_monitor_message(e.ret);for(var a=0;a<2*table_row;a++)if($("#Monitor_table_cell"+a).attr("StatCode")==o){$("#Monitor_table_cell"+a).empty(),$("#Monitor_table_cell"+a).append(t);break}};JQ_get(request_head,t,o)};for(var e=0;e<2*table_row&&null!==$("#Monitor_table_cell"+e).attr("StatCode");e++)ajax_process(e)}}function query_static_warning(){if(Monitor_Static_table_initialized===!0){var e={action:"GetStaticMonitorTable",id:usr.id};jQuery.get(request_head,e,function(e){log(e);var t=JSON.parse(e);if("false"==t.status)return void show_expiredModule();var o=(new Date).Format("yyyy-MM-dd_hhmmss");$("#MonitorFlashTime").empty(),$("#MonitorFlashTime").append("最后刷新时间："+o);var a,l=t.ColumnName,n=t.TableData,i="<thead> <tr><th></th><th></th>";for(a=0;a<l.length;a++)i=i+"<th>"+l[a]+"</th>";for(i+="</tr></thead>",i+="<tbody>",a=0;a<n.length;a++){i+="<tr>",i=i+"<td><button type='button' class='btn btn-default lock_btn' StateCode='"+n[a][0]+"' ><em class='glyphicon glyphicon-lock ' aria-hidden='true' ></em></button></td><td><button type='button' class='btn btn-default video_btn' StateCode='"+n[a][0]+"' ><em class='glyphicon glyphicon-play ' aria-hidden='true' ></em></button></td>";for(var d=0;d<n[a].length;d++)i=i+"<td>"+n[a][d]+"</td>";i+="</tr>"}i+="</tbody>",$("#MonitorQueryTable").empty(),$("#MonitorQueryTable").append(i),if_static_table_initialize&&$("#MonitorQueryTable").DataTable().destroy();$("#MonitorQueryTable").DataTable({scrollY:!1,scrollCollapse:!0,scrollX:!0,searching:!1,autoWidth:!0,lengthChange:!1,dom:"Bfrtip",buttons:[{extend:"excel",text:"导出到excel",filename:"MonitorData"+o}]});if_static_table_initialize=!0,video_btn_click=function(){var e=$(this).attr("StateCode");void 0!==e&&show_cameraModule(e)},lock_btn_click=function(){var e=$(this).attr("StateCode");void 0!==e&&show_openlockmodule(e)},$(".video_btn").on("click",video_btn_click),$(".lock_btn").on("click",lock_btn_click)})}}function build_key_history_proj_choice(){if(null!==project_list){var e="";for(i=0;i<project_list.length;i++)e=e+"<option value="+project_list[i].id+">"+project_list[i].name+"</option>";$("#KeyHistoryProj_choice").append(e)}}function key_history_initialize(){Key_History_table_initialized===!1&&(null===project_list?(get_project_list(),window.setTimeout(build_key_history_proj_choice,wait_time_long)):build_key_history_proj_choice(),Key_History_table_initialized=!0)}function query_open_lock_history(){if(Key_History_table_initialized===!0){var e=$("#KeyHistoryProj_choice").val(),t=$("#KeyHistoryTime_choice").val(),o=$("#KeyHistoryWord_Input").val(),a={ProjCode:e,Time:t,KeyWord:o},l={action:"KeyHistory",condition:a,id:usr.id},n=function(e){if("false"==e.status)return void show_expiredModule();var t=(new Date).Format("yyyy-MM-dd_hhmmss");$("#KeyHistoryLastFlash").empty(),$("#KeyHistoryLastFlash").append("最后刷新时间："+t);var o,a=e.ColumnName,l=e.TableData,n="<thead> <tr>";for(o=0;o<a.length;o++)n=n+"<th>"+a[o]+"</th>";for(n+="</tr></thead>",n+="<tbody>",o=0;o<l.length;o++){n+="<tr>";for(var i=0;i<l[o].length;i++)n=n+"<td>"+l[o][i]+"</td>";n+="</tr>"}n+="</tbody>",$("#KeyHistoryQueryTable").empty(),$("#KeyHistoryQueryTable").append(n),if_key_history_table_initialize&&$("#KeyHistoryQueryTable").DataTable().destroy();$("#KeyHistoryQueryTable").DataTable({scrollY:!1,scrollCollapse:!0,scrollX:!0,searching:!1,autoWidth:!0,lengthChange:!1,dom:"Bfrtip",buttons:[{extend:"excel",text:"导出到excel",filename:"HistoryData"+t}]});if_key_history_table_initialize=!0};JQ_get(request_head,l,n)}}function get_alarm_type_list(){var e={action:"AlarmType"},t=function(e){return"false"==e.status?void show_expiredModule():void(alarm_type_list=e.typelist)};JQ_get(request_head,e,t)}function query_alarm(e,t,o){var a={action:"AlarmQuery",id:usr.id,StatCode:alarm_selected.StatCode,date:e,type:t},l=function(e){if("false"==e.status)return void show_expiredModule();var a=(e.StatCode,e.date),l=(e.AlarmName,e.AlarmUnit),n=(e.WarningTarget,e.minute_alarm),i=e.hour_alarm,d=e.day_alarm,r=e.minute_head,_=e.hour_head,s=e.day_head;$("#Warning_"+t+"_day").css("display","block");var c=r.length-1;c>120&&(c=120),$("#"+t+"_canvas_day").highcharts({chart:{type:"areaspline",zoomType:"x"},title:{text:o+" 分钟值日志，日期："+a},legend:{layout:"vertical",align:"left",verticalAlign:"top",x:150,y:100,floating:!0,borderWidth:1,backgroundColor:Highcharts.theme&&Highcharts.theme.legendBackgroundColor||"#FFFFFF"},xAxis:{categories:r,max:c},scrollbar:{enabled:!0},yAxis:{title:{text:o}},tooltip:{shared:!0,valueSuffix:l},credits:{enabled:!1},plotOptions:{areaspline:{fillOpacity:.5}},series:[{name:alarm_selected.StatName,data:n,turboThreshold:1500}]}),$("#Warning_"+t+"_day").css("display","none"),$("#Warning_"+t+"_week").css("display","block"),c=_.length-1,c>120&&(c=120),$("#"+t+"_canvas_week").highcharts({chart:{type:"areaspline",zoomType:"x"},title:{text:o+" 小时平均值日志，周期： "+a+" 为截至的7天 "},legend:{layout:"vertical",align:"left",verticalAlign:"top",x:150,y:100,floating:!0,borderWidth:1,backgroundColor:Highcharts.theme&&Highcharts.theme.legendBackgroundColor||"#FFFFFF"},xAxis:{categories:_,max:c},scrollbar:{enabled:!0},yAxis:{title:{text:o}},tooltip:{shared:!0,valueSuffix:l},credits:{enabled:!1},plotOptions:{areaspline:{fillOpacity:.5}},series:[{name:alarm_selected.StatName,data:i,turboThreshold:1500}]}),$("#Warning_"+t+"_week").css("display","none"),$("#Warning_"+t+"_month").css("display","block"),c=s.length-1,c>30&&(c=30),$("#"+t+"_canvas_month").highcharts({chart:{type:"areaspline",zoomType:"x"},title:{text:o+" 日平均值日志，周期： "+a+" 为截至的30天 "},legend:{layout:"vertical",align:"left",verticalAlign:"top",x:150,y:100,floating:!0,borderWidth:1,backgroundColor:Highcharts.theme&&Highcharts.theme.legendBackgroundColor||"#FFFFFF"},xAxis:{categories:s,max:c},scrollbar:{enabled:!0},yAxis:{title:{text:o}},tooltip:{shared:!0,valueSuffix:l},credits:{enabled:!1},plotOptions:{areaspline:{fillOpacity:.5}},series:[{name:alarm_selected.StatName,data:d,turboThreshold:1500}]}),$("#Warning_"+t+"_month").css("display","none"),show_table_tags()};JQ_get(request_head,a,l)}function initializeAlarmMap(){get_project_list(),get_proj_point_list(),get_monitor_list(),get_alarm_type_list();var e=parseInt($("#WCMonitorViewMap").css("min-height").replace(/[^0-9]/gi,""));window.screen.availHeight/2>e&&(e=window.screen.availHeight/2),$("#WCMonitorViewMap").css("min-height",e+"px"),map_MPMonitor=new BMap.Map("WCMonitorViewMap"),map_MPMonitor.addControl(new BMap.NavigationControl),map_MPMonitor.enableScrollWheelZoom(),map_MPMonitor.centerAndZoom(usr.city,15),window.setTimeout(alarm_addMarker,wait_time_long),window.setTimeout(build_alarm_tabs,wait_time_long),alarm_map_initialized=!0}function build_alarm_tabs(){if(null!==alarm_type_list){$("#Alarm_chart_view_nav").empty(),$("#Alarm_Chart_content").empty();var e,t="",o="";for(e=0;e<alarm_type_list.length;e++){var a="",l="";0===e&&(a="class='active'",l=" in active"),t=t+"<li class='dropdown'><a href='#' id='Warning_"+alarm_type_list[e].id+"_tab' class='dropdown-toggle' data-toggle='dropdown'>"+alarm_type_list[e].name+" <b class='caret'></b></a><ul class='dropdown-menu' role='menu' aria-labelledby='Warning_"+alarm_type_list[e].id+"_tab''><li><a href='#Warning_"+alarm_type_list[e].id+"_day' "+a+" tabindex='-1' data-toggle='tab' id='Warning_"+alarm_type_list[e].id+"_tab_day' alarmid='"+alarm_type_list[e].id+"'>分钟报表（日）</a> </li><li><a href='#Warning_"+alarm_type_list[e].id+"_week' tabindex='-1' data-toggle='tab'  id='Warning_"+alarm_type_list[e].id+"_tab_week' alarmid='"+alarm_type_list[e].id+"'>小时报表（周）</a> </li><li><a href='#Warning_"+alarm_type_list[e].id+"_month' tabindex='-1' data-toggle='tab'  id='Warning_"+alarm_type_list[e].id+"_tab_month' alarmid='"+alarm_type_list[e].id+"'> 日报表（30天）</a> </li> </ul> </li>",o=o+"<div class='Alarm_Canvas' id='Warning_"+alarm_type_list[e].id+"_day' ><div id='"+alarm_type_list[e].id+"_canvas_day' class='Alarm_Canvas'></div></div><div class='Alarm_Canvas' id='Warning_"+alarm_type_list[e].id+"_week' ><div id='"+alarm_type_list[e].id+"_canvas_week' class='Alarm_Canvas' ></div></div><div class='Alarm_Canvas' id='Warning_"+alarm_type_list[e].id+"_month' ><div id='"+alarm_type_list[e].id+"_canvas_month' class='Alarm_Canvas' ></div></div>"}for($("#Alarm_chart_view_nav").append(t),$("#Alarm_Chart_content").append(o),Warning_tab_day_click=function(){hide_all_chart(),$("#Warning_"+$(this).attr("alarmid")+"_day").css("display","block")},Warning_tab_week_click=function(){hide_all_chart(),$("#Warning_"+$(this).attr("alarmid")+"_week").css("display","block")},Warning_tab_month_click=function(){hide_all_chart(),$("#Warning_"+$(this).attr("alarmid")+"_month").css("display","block")},e=0;e<alarm_type_list.length;e++)$("#Warning_"+alarm_type_list[e].id+"_tab_day").on("click",Warning_tab_day_click),$("#Warning_"+alarm_type_list[e].id+"_tab_week").on("click",Warning_tab_week_click),$("#Warning_"+alarm_type_list[e].id+"_tab_month").on("click",Warning_tab_month_click);hide_all_chart(),$(window).resize()}}function hide_all_chart(){for(var e=0;e<alarm_type_list.length;e++)$("#Warning_"+alarm_type_list[e].id+"_day").css("display","none"),$("#Warning_"+alarm_type_list[e].id+"_week").css("display","none"),$("#Warning_"+alarm_type_list[e].id+"_month").css("display","none")}function unhide_all_chart(){for(var e=0;e<alarm_type_list.length;e++)$("#Warning_"+alarm_type_list[e].id+"_day").css("display","block"),$("#Warning_"+alarm_type_list[e].id+"_week").css("display","block"),$("#Warning_"+alarm_type_list[e].id+"_month").css("display","block")}function get_select_alarm(e){for(var t=e.split(":"),o=0;o<monitor_map_list.length;o++)if(monitor_map_list[o].StatCode==t[0])return void(alarm_selected=monitor_map_list[o]);alarm_selected=null}function get_alarmpointinfo_on_map(){null!==alarm_selected&&null!==alarm_map_handle&&(txt="<div id ='Element_card_floating'><p style='font-size:14px;' >站点名称："+alarm_selected.StatName+"</p><HR style='FILTER: alpha(opacity=100,finishopacity=0,style=3)' width='80%' color=#987cb9 SIZE=3/><div style='font-size:10px;' >站点地址："+alarm_selected.Address+"</div></div>",null!==alarm_map_handle&&alarm_map_handle.setContent(txt),$("#WCStatCode_Input").val(alarm_selected.StatName))}function alarm_addMarker(e){if(null!==monitor_map_list){var t=new BMap.Icon("./image/map-marker-ball-azure-small.png",new BMap.Size(32,32),{anchor:new BMap.Size(16,30)});alarm_mark_click=function(){get_select_alarm(this.getTitle());var e=this.getTitle(),t=new BMap.InfoWindow(e,{offset:new BMap.Size(0,(-23))});t.setWidth(400),alarm_map_handle=t,get_alarmpointinfo_on_map(),this.openInfoWindow(t),t.addEventListener("close",function(){alarm_map_handle==this&&(alarm_map_handle=null)})};for(var o=0;o<monitor_map_list.length;o++){var a=new BMap.Point(parseFloat(monitor_map_list[o].Longitude),parseFloat(monitor_map_list[o].Latitude)),l=new BMap.Marker(a,{icon:t});l.setTitle(monitor_map_list[o].StatCode+":"+monitor_map_list[o].StatName),map_MPMonitor.addOverlay(l),l.addEventListener("click",alarm_mark_click)}}}function Data_export_Normal(e,t,o,a){$("#TableQueryCondition").css("display","none"),$("#ExportTable").empty(),$("#TableExportTitle").text(e);var l={action:"TableQuery",TableName:t,Condition:o,Filter:a},n=function(t){if("false"==t.status)return void show_expiredModule();ColumnName=t.ColumnName,TableData=t.TableData;var o,a="<thead> <tr>";for(o=0;o<ColumnName.length;o++)a=a+"<th>"+ColumnName[o]+"</th>";for(a+="</tr></thead>",a+="<tbody>",o=0;o<TableData.length;o++){a+="<tr>";for(var l=0;l<TableData[o].length;l++)a=a+"<td>"+TableData[o][l]+"</td>";a+="</tr>"}a+="</tbody>",$("#ExportTable").append(a),if_table_initialize&&$("#ExportTable").DataTable().destroy();$("#ExportTable").DataTable({scrollY:200,scrollCollapse:!0,scrollX:!0,searching:!1,autoWidth:!0,lengthChange:!1,dom:"Bfrtip",buttons:[{extend:"excel",text:"导出到excel",filename:e+(new Date).Format("yyyy-MM-dd_hhmmss")}]});if_table_initialize=!0,modal_middle($("#TableExportModule")),$("#TableExportModule").modal("show")};JQ_get(request_head,l,n)}function Data_export_alarm(){if_table_initialize&&($("#ExportTable").DataTable().destroy(),if_table_initialize=!1),$("#ExportTable").empty(),$("#TableQueryCondition").css("display","block"),$("#TableExportTitle").text("告警日志导出"),$("#QueryProjCode_choice").empty(),$("#QueryStatCode_choice").empty(),null!==alarm_selected?($("#QueryProjCode_choice").append(get_proj_option(alarm_selected.ProjCode)),get_proj_point_option($("#QueryProjCode_choice").val(),$("#QueryStatCode_choice"),alarm_selected.StatCode),$("#QueryStatCode_choice").val(alarm_selected.StatCode)):($("#QueryProjCode_choice").append(get_proj_option()),get_proj_point_option($("#QueryProjCode_choice").val(),$("#QueryStatCode_choice"),"")),$("#QueryStartTime_Input").val(get_yesterday()),$("#QueryEndTime_Input").val(get_yesterday()),modal_middle($("#TableExportModule")),$("#TableExportModule").modal("show")}function submit_alarm_query(){var e=$("#QueryStatCode_choice").val(),t=$("#QueryAlarm_choice").val(),o=$("#QueryStartTime_Input").val(),a=$("#QueryEndTime_Input").val();if(""===e)return void $("#QueryStatCode_choice").focus();var l=[],n={ConditonName:"UserId",Equal:usr.id,GEQ:"",LEQ:""};l.push(n),n={ConditonName:"StatCode",Equal:e,GEQ:"",LEQ:""},l.push(n),n={ConditonName:"AlarmType",Equal:t,GEQ:"",LEQ:""},l.push(n),n={ConditonName:"AlarmDate",Equal:"",GEQ:a,LEQ:o},l.push(n);var i={action:"TableQuery",TableName:"Alarmtable",Condition:l,Filter:[]},d=function(e){if("false"==e.status)return void show_expiredModule();ColumnName=e.ColumnName,TableData=e.TableData,$("#ExportTable").empty();var t,o="<thead> <tr>";for(t=0;t<ColumnName.length;t++)o=o+"<th>"+ColumnName[t]+"</th>";for(o+="</tr></thead>",o+="<tbody>",t=0;t<TableData.length;t++){o+="<tr>";for(var a=0;a<TableData[t].length;a++)o=o+"<td>"+TableData[t][a]+"</td>";o+="</tr>"}o+="</tbody>",$("#ExportTable").append(o),if_table_initialize&&$("#ExportTable").DataTable().destroy();$("#ExportTable").DataTable({scrollY:200,scrollCollapse:!0,scrollX:!0,searching:!1,autoWidth:!0,lengthChange:!1,dom:"Bfrtip",buttons:[{extend:"excel",text:"导出到excel",filename:"日志数据导出"+$("#QueryStatCode_choice").text()+(new Date).Format("yyyy-MM-dd_hhmmss")}]});if_table_initialize=!0,modal_middle($("#TableExportModule")),$("#TableExportModule").modal("show")};JQ_get(request_head,i,d)}function get_sensor_list(){var e={action:"SensorList"},t=function(e){return"false"==e.status?void show_expiredModule():void(sensor_list=e.SensorList)};JQ_get(request_head,e,t)}function get_device_sensor(e){var t={action:"DevSensor",DevCode:e},o=function(e){return"false"==e.status?void show_expiredModule():(device_selected_sensor=e.ret,void draw_dev_detail_panel())};JQ_get(request_head,t,o)}function get_sensor_name(e){for(var t="未知传感器",o=0;o<sensor_list.length;o++)e==sensor_list[o].id&&(t=sensor_list[o].nickname);return t}function show_sensor_module(){if(null!==select_sensor){if($("#SensorExtraInfo").empty(),$("#SensorDevCode_Input").val(device_selected.DevCode),$("#SensorName_Input").val(get_sensor_name(select_sensor.id)),$("#SensorStatus_choice").val(select_sensor.status),0!==select_sensor.para.length){var e,t="";for(e=0;e<select_sensor.para.length;e++)t=t+"<div class='input-group '><span class='input-group-addon' style='min-width: 100px'>"+select_sensor.para[e].name+"</span><input type='text' class='form-control' placeholder='"+select_sensor.para[e].memo+"' aria-describedby='basic-addon1' id='SensorPara_"+select_sensor.para[e].name+"'/></div><p></p>";for($("#SensorExtraInfo").append(t),e=0;e<select_sensor.para.length;e++)$("#SensorPara_"+select_sensor.para[e].name).val(select_sensor.para[e].value)}modal_middle($("#SensorModal")),$("#SensorModal").modal("show")}}function submit_sensor_module(){if(null!==select_sensor){for(var e=[],t=0;t<select_sensor.para.length;t++){var o={name:select_sensor.para[t].name,value:$("#SensorPara_"+select_sensor.para[t].name).val()};e.push(o)}var a={action:"SensorUpdate",DevCode:device_selected.DevCode,SensorCode:select_sensor.id,status:$("#SensorStatus_choice").val(),ParaList:e},l=function(e){var t=e.status;"true"==t?(show_alarm_module(!1,"传感器修改成功！"),$("#SensorModal").modal("hide"),Initialize_dev_detail()):show_alarm_module(!0,"传感器修改失败！"+e.msg)};JQ_get(request_head,a,l)}}function get_key_auth_list(e){var t={action:"KeyAuthlist",KeyId:e},o=function(e){return"false"==e.status?void show_expiredModule():(select_key_auth=e.ret,void show_key_auth_module())};JQ_get(request_head,t,o)}function show_key_auth_module(){if(null!==select_key_auth){if($("#KeyAuthList").empty(),$("#KeyAuthNumber_Input").val(""+select_key_auth.length),0!==select_key_auth.length){var e,t="";for(t="<table data-toggle='table' class='table table-hover table-bordered' ' data-click-to-select='false' ><thead> <tr> <th>授权设备 </th> <th>授权方式 </th></tr> </thead> <tbody >",e=0;e<select_key_auth.length;e++)t=t+"<tr> <td>"+select_key_auth[e].DomainName+"</td> <td>"+select_key_auth[e].AuthWay+"</td></tr>";t+="</tbody></table>",$("#KeyAuthList").append(t)}modal_middle($("#KeyModal")),$("#KeyModal").modal("show")}}function get_user_message(){var e={action:"GetUserMsg",id:usr.id},t=function(e){var t=e.status;"true"==t?(usr_msg=e.msg,usr_ifdev=e.ifdev):show_alarm_module(!0,"获取用户信息失败，请重新登录！"+e.msg)};JQ_get(request_head,e,t)}function get_user_image(){var e={action:"GetUserImg",id:usr.id},t=function(e){var t=e.status;"true"==t?(usr_img=e.img,reflash_usr_img_table()):show_alarm_module(!0,"获取用户信息失败，请重新登录！"+e.msg)};JQ_get(request_head,e,t)}function clear_user_image(){var e={action:"ClearUserImg",id:usr.id},t=function(e){var t=e.status;"true"==t?(usr_img=[],reflash_usr_img_table()):show_alarm_module(!0,"获取用户信息失败，请重新登录！"+e.msg)};JQ_get(request_head,e,t)}function set_user_message(e,t){var o={action:"SetUserMsg",id:usr.id,msg:e,ifdev:t},a=function(e){var t=e.status;"true"==t?show_alarm_module(!0,"屏保欢迎语设置成功！"+e.msg):show_alarm_module(!0,"获取用户信息失败，请重新登录！"+e.msg)};JQ_get(request_head,o,a)}function show_usr_msg_module(){$("#UsrMsg_Input").val(usr_msg),$("#UsrDev_choice").val(usr_ifdev),reflash_usr_img_table(),$("#file-zh").fileinput({language:"zh",uploadUrl:upload_url+"?id="+usr.id,allowedFileExtensions:["jpg","png","gif"],showPreview:!0}),modal_middle($("#UsrMsgModal")),$("#UsrMsgModal").modal("show")}function reflash_usr_img_table(){$("#UsrImgTable").empty();for(var e="<thead> <tr> <th> 已上传文件</th> </tr> </thead> <tbody >",t=0;t<usr_img.length;t++)e=e+"<tr> <td>"+usr_img[t].name+"</td></tr>";$("#UsrImgTable").append(e)}function user_message_update(){var e={action:"SetUserMsg",id:usr.id,msg:$("#UsrMsg_Input").val(),ifdev:$("#UsrDev_choice").val()},t=function(e){var t=e.status;"true"==t?($("#UsrMsgModal").modal("hide"),show_alarm_module(!0,"屏保欢迎语设置成功！"+e.msg)):show_alarm_module(!0,"获取用户信息失败，请重新登录！"+e.msg)};JQ_get(request_head,e,t)}function change_camera_status(e,t,o){var a="当前：水平="+e+"/垂直="+t+"；调节单位：水平="+camera_unit_h+"/垂直="+camera_unit_v;$("#VideoModuleCameraState_Input").val(a),$("#video_img").attr("src",o)}function get_camera_unit(){var e={action:"GetCameraUnit"},t=function(e){var t=e.status;"true"==t?(camera_unit_h=e.ret.h,camera_unit_v=e.ret.v):show_alarm_module(!0,"获取摄像头基本单位，请重新登录！"+e.msg)};JQ_get(request_head,e,t)}function get_camera_status(e){var t={action:"GetCameraStatus",StatCode:e,id:usr.id},o=function(e){var t=e.status;"true"==t?change_camera_status(e.ret.h,e.ret.v,e.ret.url):show_alarm_module(!0,"获取摄像头基本单位，请重新登录！"+e.msg);
};JQ_get(request_head,t,o)}function move_camera(e,t,o){var a;a="v"==t?{action:"CameraVAdj",StatCode:e,id:usr.id,adj:o}:{action:"CameraHAdj",StatCode:e,id:usr.id,adj:o};var l=function(e){var t=e.status;"true"==t?change_camera_status(e.ret.h,e.ret.v,e.ret.url):show_alarm_module(!0,"获取摄像头基本单位，请重新登录！"+e.msg)};JQ_get(request_head,a,l)}function show_cameraModule(e){modal_middle($("#VideoSelectionModule")),$("#VideoModuleStatCode_Input").val(e),$("#VideoModule_query_Input").val(""),$("#ModuleVCRStatus_choice").empty(),get_camera_status(e),$("#VideoSelectionModule").modal("show")}function show_openlockmodule(e){$("#UnlockConfirmBtn").attr("StateCode",e),$("#UnlockConfirmModalContent").empty(),$("#UnlockConfirmModalContent").append("<strong>请确认：</strong>是否要打开站点["+e+"]的智能锁！按确认继续。"),modal_middle($("#UnlockConfirm")),$("#UnlockConfirm").modal("show")}function openlock(e){var t={action:"OpenLock",StatCode:e,id:usr.id},o=function(e){var t=e.status;if("true"==t){var o=e.auth;"true"==o?show_alarm_module(!1,"已向下位机发送开锁请求，请稍后刷新！"):show_alarm_module(!0,"无效授权！"+e.msg)}else show_alarm_module(!0,"开锁请求失败，请重新登录！"+e.msg)};JQ_get(request_head,t,o)}function get_proj_key_list(){var e={action:"ProjKeyList"},t=function(e){return"false"==e.status?void show_expiredModule():void(key_list=e.ret)};JQ_get(request_head,e,t)}function get_proj_user_list(){var e={action:"ProjUserList"},t=function(e){return"false"==e.status?void show_expiredModule():void(proj_user_list=e.ret)};JQ_get(request_head,e,t)}function build_key_auth_proj_choice(){if(null!==project_list){var e="";for(i=0;i<project_list.length;i++)e=e+"<option value="+project_list[i].id+">"+project_list[i].name+"</option>";$("#KeyAuthProj_choice").append(e),$("#KeyUserProj_choice").append(e),update_key_auth_proj_stat_choice($("#KeyAuthProj_choice").val(),$("#KeyAuthProj_choice").find("option:selected").text()),update_key_auth_proj_key_choice($("#KeyUserProj_choice").val()),update_key_auth_proj_user_choice($("#KeyUserProj_choice").val()),$("#KeyAuthProj_choice").change(function(){update_key_auth_proj_stat_choice($(this).val(),$(this).find("option:selected").text())}),$("#KeyUserProj_choice").change(function(){update_key_auth_proj_key_choice($(this).val())})}}function update_key_auth_proj_stat_choice(e,t){$("#KeyAuthPoint_choice").empty();var o="";for(i=0;i<point_list.length;i++)point_list[i].ProjCode==e&&(o=o+"<option value="+point_list[i].id+">"+point_list[i].name+"</option>");o="<option value="+e+">"+t+":全项目</option>"+o,$("#KeyAuthPoint_choice").append(o)}function update_key_auth_proj_key_choice(e){$("#KeyUserKey_choice").empty();var t="";for(i=0;i<key_list.length;i++)key_list[i].ProjCode==e&&(t=t+"<option value="+key_list[i].id+">"+key_list[i].name+":"+key_list[i].username+"</option>");$("#KeyUserKey_choice").append(t)}function update_new_key_auth_key_choice(e){$("#NewKeyAuthKey_choice").empty();var t="";for(i=0;i<key_list.length;i++)key_list[i].ProjCode==e&&(t=t+"<option value="+key_list[i].id+">"+key_list[i].name+":"+key_list[i].username+"</option>");$("#NewKeyAuthKey_choice").append(t)}function update_key_auth_proj_user_choice(e){$("#KeyUserUser_choice").empty();var t="";for(i=0;i<proj_user_list.length;i++)proj_user_list[i].ProjCode==e&&(t=t+"<option value="+proj_user_list[i].id+">"+proj_user_list[i].name+"</option>");t="<option value='none'>部门收管</option>"+t,$("#KeyUserUser_choice").append(t)}function key_auth_initialize(){Key_auth_initialized===!1&&(null===project_list||null===point_list||null===key_list||null===proj_user_list?(get_project_list(),get_proj_point_list(),get_proj_key_list(),get_proj_user_list(),window.setTimeout(build_key_auth_proj_choice,wait_time_middle)):build_key_auth_proj_choice(),Key_auth_initialized=!0)}function get_domain_auth_list(e){if(""!==e){var t={action:"DomainAuthlist",DomainCode:e},o=function(e){if("false"==e.status)return void show_expiredModule();var t=e.ret,o="<thead><tr><th></th><th>编号</th><th>钥匙</th><th>用户</th><th>授权条件</th></tr></thead><tbody>";$("#Table_point_key_auth").empty();for(var a=0;a<t.length;a++)o=o+"<tr> <td><button type='button' class='btn btn-default Auth_del_btn' AuthId='"+t[a].AuthId+"' ><em class='glyphicon glyphicon-trash ' aria-hidden='true' ></em></button></td>",o=o+"<td>"+t[a].AuthId+"</td><td>"+t[a].KeyName+"</td><td>"+t[a].UserName+"</td><td>"+t[a].AuthWay+"</td></tr>";o+="</tbody>",$("#Table_point_key_auth").append(o),$(".Auth_del_btn").on("click",function(){touchcookie(),show_auth_delete_module($(this).attr("AuthId"))})};JQ_get(request_head,t,o)}}function show_auth_delete_module(e){$("#delKeyAuthCommit").attr("AuthId",e),$("#KeyAuthDelAlertModalLabel").text("确认删除 授权"+e),modal_middle($("#KeyAuthDelAlarm")),$("#KeyAuthDelAlarm").modal("show")}function key_auth_delete(e){if(""!==e){var t={action:"KeyAuthDel",AuthId:e,id:usr.id},o=function(e){var t=e.status;"true"==t?(show_alarm_module(!1,"删除成功！"),get_domain_auth_list($("#KeyAuthPoint_choice").val())):show_alarm_module(!0,"修改失败！"+e.msg)};JQ_get(request_head,t,o)}}function show_auth_new_module(e,t,o){$("#newKeyAuthCommit").attr("DomainId",t),$("#NewKeyAuthDomain_Input").val(o),update_new_key_auth_key_choice(e),$("NewKeyAuthEndTime_Input").val(""),modal_middle($("#newKeyAuthModal")),$("#newKeyAuthModal").modal("show")}function new_key_auth(e){var t={action:"KeyAuthNew",Auth:e,id:usr.id},o=function(e){var t=e.status;"true"==t?(show_alarm_module(!1,"新建成功！"),get_domain_auth_list($("#KeyAuthPoint_choice").val())):show_alarm_module(!0,"新建失败！"+e.msg)};JQ_get(request_head,t,o)}function click_new_key_auch_commit(){var e=$("#newKeyAuthCommit").attr("DomainId"),t=$("#NewKeyAuthKey_choice").val(),o=$("#NewKeyAuthEndTime_Input").val();""===o&&(o="always");var a={DomainId:e,KeyId:t,Authway:o};$("#newKeyAuthModal").modal("hide"),new_key_auth(a)}function check_key_auth_date(e){if(""===e)return e;var t=new Date(e.replace(/-/g,"/"));if("Invalid Date"==t.getdate)return"";var o=new Date;return t.getTime()<o.getTime()?"":t.Format("yyyy-MM-dd")}function show_key_grant_module(e,t,o,a){$("#KeyGrantCommit").attr("KeyId",e),$("#KeyGrantCommit").attr("UserId",t),$("#KeyGrantAlertModalLabel").empty(),$("#KeyGrantAlertModalLabel").append("确定转移 "+o+"->"+a),modal_middle($("#KeyGrantAlarm")),$("#KeyGrantAlarm").modal("show")}function click_key_grant_commit(e,t){var o={action:"KeyGrant",KeyId:e,UserId:t,id:usr.id},a=function(e){var t=e.status;"true"==t?(show_alarm_module(!1,"变更成功！"),get_domain_auth_list($("#KeyAuthPoint_choice").val()),get_proj_key_list(),window.setTimeout(build_key_auth_proj_choice,wait_time_middle)):show_alarm_module(!0,"变更失败！"+e.msg)};JQ_get(request_head,o,a)}var basic_address=getRelativeURL()+"/";console.log(basic_address);var wait_time_long=3e3,wait_time_middle=1e3,wait_time_short=500,cycle_time=6e4,request_head=basic_address+"request.php",jump_url=basic_address+"jump.php",upload_url=basic_address+"upload.php",screen_saver_address=basic_address+"screensaver/screen.html",usr;usr="";var admin="",keystr="",table_row=5,usr_msg="",usr_ifdev="true",usr_img=[],current_table,table_head,map_MPMonitor,map_initialized=!1,user_initial=!1,user_start=0,user_total=0,project_pg_list=null,user_table=null,user_selected,user_selected_auth,user_selected_key,NewUserAuthDual2,user_module_status,pg_initial=!1,pg_start=0,pg_total=0,pg_table=null,pg_selected,pg_selected_proj,NewPGProjDual2,pg_module_status,project_list=null,project_initial=!1,project_start=0,project_total=0,project_table=null,project_selected,project_selected_device,project_module_status,parameter_initial=!1,software_version_list=null,point_initial=!1,point_start=0,point_total=0,point_table=null,point_selected,project_selected_point,project_selected_key,point_module_status,point_list=null,device_initial=!1,device_start=0,device_total=0,device_table=null,device_selected,device_selected_sensor,device_module_status,key_list=null,proj_user_list=null,key_initial=!1,key_start=0,key_total=0,key_table=null,key_selected,key_selected_auth,key_module_status,monitor_map_list=null,monitor_handle,monitor_selected=null,monitor_list=null,monitor_string="",monitor_map_handle=null,Monitor_table_initialized=!1,Monitor_table_start=0,Monitor_table_total=0,Monitor_Static_table_initialized=!0,if_static_table_initialize=!1,Key_History_table_initialized=!1,if_key_history_table_initialize=!1,Key_auth_initialized=!1,alarm_type_list=null,alarm_map_initialized=!1,alarm_selected=null,alarm_map_handle=null,alarm_array=null,export_table_name=null,if_table_initialize=!1,sensor_list=null,select_sensor_devcode=null,select_sensor=null,select_key_auth=null,camera_unit_h,camera_unit_v,CURRENT_URL="desktop",$BODY=$("body"),$MENU_TOGGLE=$("#menu_toggle"),$SIDEBAR_MENU=$("#sidebar-menu"),$SIDEBAR_FOOTER=$(".sidebar-footer"),$LEFT_COL=$(".left_col"),$RIGHT_COL=$(".right_col"),$NAV_MENU=$(".nav_menu"),$FOOTER=$("footer");$(document).ready(function(){var e=document.querySelectorAll(".cycle-menuItem");console.log("items="+e.length);for(var t=0,o=e.length;t<o;t++)e[t].style.left=(50-35*Math.cos(-.5*Math.PI-2*(1/o)*t*Math.PI)).toFixed(4)+"%",e[t].style.top=(50+35*Math.sin(-.5*Math.PI-2*(1/o)*t*Math.PI)).toFixed(4)-15*(t+1)+"%";document.querySelector(".cycle-circle").classList.toggle("open");var a=function(){$RIGHT_COL.css("min-height",$(window).height());var e=$BODY.outerHeight(),t=$FOOTER.outerHeight(),o=$LEFT_COL.eq(1).height()+$SIDEBAR_FOOTER.height(),a=e<o?o:e;a-=$NAV_MENU.outerHeight()+t,$RIGHT_COL.css("min-height",a)};$SIDEBAR_MENU.find("a").on("click",function(e){var t=$(this).parent();t.is(".active")?(t.removeClass("active active-sm"),$("ul:first",t).slideUp(function(){a()})):(t.parent().is(".child_menu")||($SIDEBAR_MENU.find("li").removeClass("active active-sm"),$SIDEBAR_MENU.find("li ul").slideUp()),t.addClass("active"),$("ul:first",t).slideDown(function(){a()}))}),$MENU_TOGGLE.on("click",function(){$BODY.hasClass("nav-md")?($SIDEBAR_MENU.find("li.active ul").hide(),$SIDEBAR_MENU.find("li.active").addClass("active-sm").removeClass("active")):($SIDEBAR_MENU.find("li.active-sm ul").show(),$SIDEBAR_MENU.find("li.active-sm").addClass("active").removeClass("active-sm")),$BODY.toggleClass("nav-md nav-sm"),a()}),$SIDEBAR_MENU.find('a[href="#"]').on("click",function(){$BODY.hasClass("nav-md")||$(this).parent().parent().slideUp()}),$(window).smartresize(function(){a()}),a(),$.fn.mCustomScrollbar&&$(".menu_fixed").mCustomScrollbar({autoHideScrollbar:!0,theme:"minimal",mouseWheel:{preventDefault:!0}})}),function(e,t){var o=function(e,t,o){var a;return function(){function l(){o||e.apply(n,i),a=null}var n=this,i=arguments;a?clearTimeout(a):o&&e.apply(n,i),a=setTimeout(l,t||100)}};jQuery.fn[t]=function(e){return e?this.bind("resize",o(e)):this.trigger(t)}}(jQuery,"smartresize"),window.onload=function(){},$(document).ready(function(){$("[data-toggle='modal']").click(function(){var e=$(this).attr("data-target");t=setTimeout(function(){var t=$(e).find(".modal-dialog");t.animate({"margin-top":parseInt(($(window).height()-t.height())/2)},300)},wait_time_short)}),$(".form_date").datetimepicker({language:"zh-CN",weekStart:1,todayBtn:1,autoclose:1,todayHighlight:1,startView:2,minView:2,forceParse:0}),NewUserAuthDual2=$(".NewUserAuthDual").bootstrapDualListbox({nonSelectedListLabel:"全部项目（组）",selectedListLabel:"用户权限",preserveSelectionOnMove:"moved",moveOnSelect:!0,nonSelectedFilter:"",showFilterInputs:!1,infoText:""}),$("#showValue").click(function(){alert($('[name="duallistbox_demo1"]').val())}),NewPGProjDual2=$(".NewPGProjDual").bootstrapDualListbox({nonSelectedListLabel:"全部项目",selectedListLabel:"本组包含",preserveSelectionOnMove:"moved",moveOnSelect:!0,nonSelectedFilter:"",showFilterInputs:!1,infoText:""}),DevUpdateDual2=$(".DevUpdateAuthDual").bootstrapDualListbox({nonSelectedListLabel:"当前设备",selectedListLabel:"需要升级",preserveSelectionOnMove:"moved",moveOnSelect:!0,nonSelectedFilter:"",showFilterInputs:!1,infoText:""}),$("#Desktop").css("min-height",window.screen.availHeight-300),$("#Undefined").css("min-height",window.screen.availHeight-300);setInterval(get_monitor_warning_on_map,cycle_time),setInterval(query_warning,cycle_time);PageInitialize(),$("#menu_logout").on("click",function(){logout()}),$("#UserManage").on("click",function(){CURRENT_URL="UserManage",active_menu("UserManage"),touchcookie(),user_manager()}),$("#KeyManage").on("click",function(){CURRENT_URL="KeyManage",active_menu("KeyManage"),touchcookie(),key_manage()}),$("#PGManage").on("click",function(){CURRENT_URL="PGManage",active_menu("PGManage"),touchcookie(),pg_manage()}),$("#ProjManage").on("click",function(){CURRENT_URL="ProjManage",active_menu("ProjManage"),touchcookie(),proj_manage()}),$("#ParaManage").on("click",function(){CURRENT_URL="ParaManage",active_menu("ParaManage"),touchcookie(),para_manage()}),$("#MPManage").on("click",function(){CURRENT_URL="MPManage",active_menu("MPManage"),touchcookie(),mp_manage()}),$("#DevManage").on("click",function(){CURRENT_URL="DevManage",active_menu("DevManage"),touchcookie(),dev_manage()}),$("#MPMonitor").on("click",function(){CURRENT_URL="MPMonitor",active_menu("MPMonitor"),touchcookie(),mp_monitor()}),$("#MPMonitorTable").on("click",function(){CURRENT_URL="MPMonitorTable",active_menu("MPMonitorTable"),touchcookie(),mp_monitor_table()}),$("#MPMonitorCard").on("click",function(){CURRENT_URL="MPMonitorCard",active_menu("MPMonitorCard"),touchcookie(),mp_monitor_card()}),$("#MPStaticMonitorTable").on("click",function(){CURRENT_URL="MPStaticMonitorTable",active_menu("MPStaticMonitorTable"),touchcookie(),mp_static_monitor_table()}),$("#WarningCheck").on("click",function(){CURRENT_URL="WarningCheck",active_menu("WarningCheck"),touchcookie(),warning_check()}),$("#WarningHandle").on("click",function(){CURRENT_URL="WarningHandle",active_menu("WarningHandle"),touchcookie(),warning_handle()}),$("#InstConf").on("click",function(){CURRENT_URL="InstConf",active_menu("InstConf"),touchcookie(),Inst_Conf()}),$("#InstRead").on("click",function(){CURRENT_URL="InstRead",active_menu("InstRead"),touchcookie(),Inst_Read()}),$("#InstDesign").on("click",function(){CURRENT_URL="InstDesign",active_menu("InstDesign"),touchcookie(),Inst_Design()}),$("#InstControl").on("click",function(){CURRENT_URL="InstControl",active_menu("InstControl"),touchcookie(),Inst_Control()}),$("#InstSnapshot").on("click",function(){CURRENT_URL="InstSnapshot",active_menu("InstSnapshot"),touchcookie(),Inst_Snapshot()}),$("#InstVideo").on("click",function(){CURRENT_URL="InstVideo",active_menu("InstVideo"),touchcookie(),Inst_Video()}),$("#AuditTarget").on("click",function(){CURRENT_URL="AuditTarget",active_menu("AuditTarget"),touchcookie(),Audit_Target()}),$("#AuditStability").on("click",function(){CURRENT_URL="AuditStability",active_menu("AuditStability"),touchcookie(),Audit_Stability()}),$("#AuditAvailability").on("click",function(){CURRENT_URL="AuditAvailability",active_menu("AuditAvailability"),touchcookie(),Audit_Availability()}),$("#AuditError").on("click",function(){CURRENT_URL="AuditError",active_menu("AuditError"),touchcookie(),Audit_Error()}),$("#AuditQuality").on("click",function(){CURRENT_URL="AuditQuality",active_menu("AuditQuality"),touchcookie(),Audit_Quality()}),$("#GeoInfoQuery").on("click",function(){CURRENT_URL="GeoInfoQuery",active_menu("GeoInfoQuery"),touchcookie(),Geo_InfoQuery()}),$("#GeoTrendAnalysis").on("click",function(){CURRENT_URL="GeoTrendAnalysis",active_menu("GeoTrendAnalysis"),touchcookie(),Geo_TrendAnalysis()}),$("#GeoDisaterForecast").on("click",function(){CURRENT_URL="GeoDisaterForecast",active_menu("GeoDisaterForecast"),touchcookie(),Geo_DisaterForecast()}),$("#GeoEmergencyDirect").on("click",function(){CURRENT_URL="GeoEmergencyDirect",active_menu("GeoEmergencyDirect"),touchcookie(),Geo_EmergencyDirect()}),$("#GeoDiffusionAnalysis").on("click",function(){CURRENT_URL="GeoDiffusionAnalysis",active_menu("GeoDiffusionAnalysis"),touchcookie(),Geo_DiffusionAnalysis()}),$("#WorkflowDesign").on("click",function(){CURRENT_URL="WorkflowDesign",active_menu("WorkflowDesign"),touchcookie(),Work_flowDesign()}),$("#OrderManagement").on("click",function(){CURRENT_URL="OrderManagement",active_menu("OrderManagement"),touchcookie(),Order_Management()}),$("#UnloadingManagement").on("click",function(){CURRENT_URL="UnloadingManagement",active_menu("UnloadingManagement"),touchcookie(),Unloading_Management()}),$("#OrderAudit").on("click",function(){CURRENT_URL="OrderAudit",active_menu("OrderAudit"),touchcookie(),Order_Audit()}),$("#ADConf").on("click",function(){CURRENT_URL="ADConf",active_menu("ADConf"),touchcookie(),AD_Conf()}),$("#WEBConf").on("click",function(){CURRENT_URL="WEBConf",active_menu("WEBConf"),touchcookie(),WEB_Conf()}),$("#KeyManage").on("click",function(){CURRENT_URL="KeyManage",active_menu("KeyManage"),touchcookie(),key_manage()}),$("#KeyAuth").on("click",function(){CURRENT_URL="KeyAuth",active_menu("KeyAuth"),touchcookie(),key_auth()}),$("#KeyHistory").on("click",function(){CURRENT_URL="KeyHistory",active_menu("KeyHistory"),touchcookie(),key_history()}),$("#UserfreshButton").on("click",function(){touchcookie(),clear_user_detail_panel(),user_intialize(0)}),$("#UserExportButton").on("click",function(){touchcookie();var e=[],t={ConditonName:"UserId",Equal:usr.id,GEQ:"",LEQ:""};e.push(t),Data_export_Normal("用户表导出","usertable",e,[])}),$("#UserNewButton").on("click",function(){touchcookie(),show_new_user_module()}),$("#UserDelButton").on("click",function(){touchcookie(),null===user_selected?show_alarm_module(!0,"请选择一个用户"):(modal_middle($("#UserDelAlarm")),$("#UserDelAlarm").modal("show"))}),$("#UserModifyButton").on("click",function(){touchcookie(),null===user_selected?show_alarm_module(!0,"请选择一个用户"):show_mod_user_module(user_selected,user_selected_auth)}),$("#delUserCommit").on("click",function(){del_user(user_selected.id),touchcookie()}),$("#newUserCommit").on("click",function(){user_module_status?(submit_new_user_module(),touchcookie()):(submit_mod_user_module(),touchcookie())}),$("#PGfreshButton").on("click",function(){touchcookie(),clear_pg_detail_panel(),pg_intialize(0)}),$("#PGExportButton").on("click",function(){touchcookie();var e=[],t={ConditonName:"UserId",Equal:usr.id,GEQ:"",LEQ:""};e.push(t),Data_export_Normal("项目组表导出","PGtable",e,[])}),$("#PGNewButton").on("click",function(){touchcookie(),show_new_pg_module()}),$("#PGDelButton").on("click",function(){touchcookie(),null===pg_selected?show_alarm_module(!0,"请选择一个项目组"):(modal_middle($("#PGDelAlarm")),$("#PGDelAlarm").modal("show"))}),$("#PGModifyButton").on("click",function(){touchcookie(),null===pg_selected?show_alarm_module(!0,"请选择一个项目组"):show_mod_pg_module(pg_selected,pg_selected_proj)}),$("#delPGCommit").on("click",function(){del_pg(pg_selected.PGCode),touchcookie()}),$("#newPGCommit").on("click",function(){pg_module_status?(submit_new_pg_module(),touchcookie()):(submit_mod_pg_module(),touchcookie())}),$("#ProjfreshButton").on("click",function(){touchcookie(),clear_proj_detail_panel(),proj_intialize(0)}),$("#ProjExportButton").on("click",function(){touchcookie();var e=[],t={ConditonName:"UserId",Equal:usr.id,GEQ:"",LEQ:""};e.push(t),Data_export_Normal("项目表导出","Projtable",e,[])}),$("#ProjNewButton").on("click",function(){touchcookie(),show_new_proj_module()}),$("#ProjDelButton").on("click",function(){touchcookie(),null===project_selected?show_alarm_module(!0,"请选择一个项目"):(modal_middle($("#ProjDelAlarm")),$("#ProjDelAlarm").modal("show"))}),$("#ProjModifyButton").on("click",function(){touchcookie(),null===project_selected?show_alarm_module(!0,"请选择一个项目"):show_mod_proj_module(project_selected)}),$("#delProjCommit").on("click",function(){del_proj(project_selected.ProjCode),touchcookie()}),$("#newProjCommit").on("click",function(){project_module_status?(submit_new_proj_module(),touchcookie()):(submit_mod_proj_module(),touchcookie())}),$("#PointfreshButton").on("click",function(){touchcookie(),clear_point_detail_panel(),point_intialize(0)}),$("#PointExportButton").on("click",function(){touchcookie();var e=[],t={ConditonName:"UserId",Equal:usr.id,GEQ:"",LEQ:""};e.push(t),Data_export_Normal("站点导出","Pointtable",e,[])}),$("#PointNewButton").on("click",function(){touchcookie(),show_new_point_module()}),$("#PointDelButton").on("click",function(){touchcookie(),null===point_selected?show_alarm_module(!0,"请选择一个站点"):(modal_middle($("#PointDelAlarm")),$("#PointDelAlarm").modal("show"))}),$("#PointModifyButton").on("click",function(){touchcookie(),null===point_selected?show_alarm_module(!0,"请选择一个站点"):show_mod_point_module(point_selected)}),$("#delPointCommit").on("click",function(){del_point(point_selected.StatCode),touchcookie()}),$("#newPointCommit").on("click",function(){point_module_status?(submit_new_point_module(),touchcookie()):(submit_mod_point_module(),touchcookie())}),$("#DevfreshButton").on("click",function(){touchcookie(),clear_dev_detail_panel(),dev_intialize(0)}),$("#DevExportButton").on("click",function(){touchcookie();var e=[],t={ConditonName:"UserId",Equal:usr.id,GEQ:"",LEQ:""};e.push(t),Data_export_Normal("设备表导出","Devtable",e,[])}),$("#DevNewButton").on("click",function(){touchcookie(),show_new_dev_module()}),$("#DevDelButton").on("click",function(){touchcookie(),null===device_selected?show_alarm_module(!0,"请选择一个设备"):(modal_middle($("#DevDelAlarm")),$("#DevDelAlarm").modal("show"))}),$("#DevModifyButton").on("click",function(){touchcookie(),null===device_selected?show_alarm_module(!0,"请选择一个设备"):show_mod_dev_module(device_selected)}),$("#delDevCommit").on("click",function(){del_dev(device_selected.DevCode),touchcookie()}),$("#newDevCommit").on("click",function(){device_module_status?(submit_new_dev_module(),touchcookie()):(submit_mod_dev_module(),touchcookie())}),$("#DevProjCode_choice").change(function(){get_proj_point_option($("#DevProjCode_choice").val(),$("#DevStatCode_choice"),"")}),$("#QueryProjCode_choice").change(function(){get_proj_point_option($("#QueryProjCode_choice").val(),$("#QueryStatCode_choice"),"")}),$("#AlarmQueryCommit").on("click",function(){if(touchcookie(),null===alarm_selected)return void $("#WCStatCode_Input").attr("placeholder","请先在地图上选择一个点");if(""===$("#Alarm_query_Input").val()||null===$("#Alarm_query_Input").val())return void $("#Alarm_query_Input").attr("placeholder","请输入日期");if(null!==alarm_type_list){unhide_all_chart();for(var e=0;e<alarm_type_list.length;e++)query_alarm($("#Alarm_query_Input").val(),alarm_type_list[e].id,alarm_type_list[e].name)}}),$("#Video_query_Input").change(function(){$("#Video_query_Input").val(date_compare_today($("#Video_query_Input").val())),video_selection_change()}),$("#VideoHour_choice").change(function(){video_selection_change()}),$("#VideoModuleHour_choice").change(function(){video_Module_selection_change()}),$("#VideoModule_query_Input").change(function(){video_Module_selection_change()}),$("#Alarm_query_Input").change(function(){$("#Alarm_query_Input").val(date_compare_today($("#Alarm_query_Input").val()))}),$("#AlarmExport").on("click",function(){touchcookie(),Data_export_alarm()}),$("#AlarmQuery_Commit").on("click",function(){touchcookie(),submit_alarm_query()}),$("#SensorUpdateCommit").on("click",function(){touchcookie(),submit_sensor_module()}),$("#ExpiredConfirm").on("click",function(){logout()}),$("#QueryStartTime_Input").change(function(){$("#QueryStartTime_Input").val(date_compare_today($("#QueryStartTime_Input").val())),""===$("#QueryEndTime_Input").val()?$("#QueryEndTime_Input").val($("#QueryStartTime_Input").val()):$("#QueryEndTime_Input").val(date_compare($("#QueryEndTime_Input").val(),$("#QueryStartTime_Input").val()))}),$("#QueryEndTime_Input").change(function(){""===$("#QueryStartTime_Input").val()?($("#QueryEndTime_Input").val(date_compare_today($("#QueryEndTime_Input").val())),$("#QueryStartTime_Input").val($("#QueryStartTime_Input").val())):$("#QueryEndTime_Input").val(date_compare($("#QueryEndTime_Input").val(),$("#QueryStartTime_Input").val()))}),$("#VCRshow").on("click",function(){var e=$("#VCRStatus_choice").val();""!==e&&video_windows(e)}),$("#ModuleVCRshow").on("click",function(){var e=$("#ModuleVCRStatus_choice").val();""!==e&&video_windows(e)}),$("#MonitorTableFlash").on("click",function(){query_static_warning()}),$("#menu_user_profile").on("click",function(){touchcookie(),show_usr_msg_module()}),$("#ScreenSaver").on("click",function(){null!==monitor_selected&&screen_windows()}),$("#UsrMsgCommit").on("click",function(){touchcookie(),user_message_update()}),$("#UsrImgClean").on("click",function(){touchcookie(),clear_user_image()}),$("#UsrImgFlash").on("click",function(){touchcookie(),get_user_image()}),$("#UpdateConfirm_button").on("click",function(){touchcookie(),update_version()}),$("#btn_camera_up").on("click",function(){var e=$("#VideoModuleStatCode_Input").val();void 0!==e&&""!==e&&move_camera(e,"v","1")}),$("#btn_camera_down").on("click",function(){var e=$("#VideoModuleStatCode_Input").val();void 0!==e&&""!==e&&move_camera(e,"v","-1")}),$("#btn_camera_right").on("click",function(){var e=$("#VideoModuleStatCode_Input").val();void 0!==e&&""!==e&&move_camera(e,"v","1")}),$("#btn_camera_left").on("click",function(){var e=$("#VideoModuleStatCode_Input").val();void 0!==e&&""!==e&&move_camera(e,"v","-1")}),$(".lock_monitor_btn").on("click",function(){monitor_lock()}),$("#UnlockConfirmBtn").on("click",function(){var e=$(this).attr("StateCode");void 0!==e&&""!==e&&openlock(e)}),$(".keyrow").on("click",function(){var e=$(this).attr("id");void 0!==e&&""!==e&&get_key_auth_list(e)}),$("#KeyfreshButton").on("click",function(){touchcookie(),clear_key_detail_panel(),key_intialize(0)}),$("#KeyExportButton").on("click",function(){touchcookie();var e=[],t={ConditonName:"UserId",Equal:usr.id,GEQ:"",LEQ:""};e.push(t),Data_export_Normal("钥匙表导出","keytable",e,[])}),$("#KeyNewButton").on("click",function(){touchcookie(),show_new_key_module()}),$("#KeyDelButton").on("click",function(){touchcookie(),null===key_selected?show_alarm_module(!0,"请选择一把钥匙"):(modal_middle($("#KeyDelAlarm")),$("#KeyDelAlarm").modal("show"))}),$("#KeyModifyButton").on("click",function(){touchcookie(),null===key_selected?show_alarm_module(!0,"请选择一把钥匙"):show_mod_key_module(key_selected)}),$("#delKeyCommit").on("click",function(){del_key(key_selected.KeyCode),touchcookie()}),$("#newKeyCommit").on("click",function(){key_module_status?(submit_new_key_module(),touchcookie()):(submit_mod_key_module(),touchcookie())}),$("#KeyHistoryTableFlash").on("click",function(){query_open_lock_history(),touchcookie()}),$("#KeyAuthQuery").on("click",function(){get_domain_auth_list($("#KeyAuthPoint_choice").val()),touchcookie()}),$("#KeyAuthNew").on("click",function(){show_auth_new_module($("#KeyAuthProj_choice").val(),$("#KeyAuthPoint_choice").val(),$("#KeyAuthPoint_choice").find("option:selected").text()),touchcookie()}),$("#KeyUserChange").on("click",function(){show_key_grant_module($("#KeyUserKey_choice").val(),$("#KeyUserUser_choice").val(),$("#KeyUserKey_choice").find("option:selected").text(),$("#KeyUserUser_choice").find("option:selected").text()),touchcookie()}),$("#delKeyAuthCommit").on("click",function(){$("#KeyAuthDelAlarm").modal("hide"),key_auth_delete($(this).attr("AuthId")),touchcookie()}),$("#newKeyAuthCommit").on("click",function(){click_new_key_auch_commit(),touchcookie()}),$("#NewKeyAuthEndTime_Input").change(function(){$("#NewKeyAuthEndTime_Input").val(check_key_auth_date($(this).val()))}),$("#KeyGrantCommit").on("click",function(){$("#KeyGrantAlarm").modal("hide"),click_key_grant_commit($(this).attr("KeyId"),$(this).attr("UserId"))}),clear_window(),desktop(),calculate_row(),clear_user_detail_panel(),clear_proj_detail_panel(),$(window).resize()});